<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ë³µì§€ê´€2ì¸µë§¤ì¥</title>

<!-- ì„œë¹„ìŠ¤ì›Œì»¤ ì™„ì „ ë¬´ë ¥í™” -->
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistrations().then(regs=>{
    regs.forEach(r=>r.unregister());
  });
}
</script>

<style>
:root{
  --bg:#f5f6f8;
  --card:#ffffff;
  --ink:#111827;
  --muted:#6b7280;
  --line:#e5e7eb;

  --price:#ef4444;
  --tab:#2563eb;

  --call:#22c55e;
  --sms:#38bdf8;
  --kakao:#fee500;
}

*{box-sizing:border-box;}
html,body{margin:0;padding:0;}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",system-ui,sans-serif;
  background:var(--bg);
  color:var(--ink);
}

/* ===============================
   ğŸ”¥ ë„¤ì˜¨ ê´‘ê³ ë°°ë„ˆ (ìµœìƒë‹¨)
================================ */
.neon-banner{
  margin:12px;
  padding:16px 14px;
  background:linear-gradient(135deg,#fff200,#ffe066);
  border-radius:16px;
  border:2px solid #fff6a3;
  box-shadow:
    0 0 8px rgba(255,242,0,.9),
    0 0 18px rgba(255,242,0,.7),
    0 0 32px rgba(255,242,0,.5);
  pointer-events:none;
}
.neon-title{
  font-size:18px;
  font-weight:1000;
  text-align:center;
  letter-spacing:-0.02em;
}
.neon-points{
  margin-top:10px;
  display:grid;
  gap:6px;
}
.neon-point{
  font-size:15px;
  font-weight:900;
  text-align:center;
}
.neon-point b{
  font-weight:1000;
  text-decoration:underline;
  text-underline-offset:3px;
}

/* ===============================
   íƒ­ (SK/KT/LG/í•«ë”œ/ì €ê°€) - ì••ì¶• 1ì¤„
================================ */
.tabs{
  display:flex;
  gap:6px;
  padding:10px 8px;
  background:#fff;
  border-bottom:1px solid var(--line);
  overflow-x:auto;               /* ì•„ì£¼ ì‘ì€ í™”ë©´ ë³´í—˜ */
  -webkit-overflow-scrolling:touch;
  white-space:nowrap;
}
.tab{
  flex:1 1 0;                    /* 5ê°œ ìë™ ë¶„ë°° */
  min-width:0;                   /* ëª¨ë°”ì¼ì—ì„œ ë°€ë¦¼ ë°©ì§€(í•µì‹¬) */
  padding:12px 0;
  text-align:center;
  font-weight:900;
  font-size:14px;
  border-radius:12px;
  background:#f3f4f6;
  cursor:pointer;
  user-select:none;
}
.tab.active{
  background:var(--tab);
  color:#fff;
}

/* ì¹´ë“œ */
.main{padding:12px;padding-bottom:190px;}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.card{
  background:var(--card);
  border-radius:18px;
  padding:16px;
  box-shadow:0 4px 12px rgba(0,0,0,.05);
}
.badge{font-size:12px;font-weight:900;color:#2563eb;margin-bottom:6px;}
.model{font-size:16px;font-weight:900;margin-bottom:6px;line-height:1.15;}
.price{font-size:26px;font-weight:900;color:var(--price);line-height:1.05;}
.sub{font-size:13px;color:var(--muted);font-weight:700;margin-top:6px;line-height:1.25;}

/* íœ´ëŒ€í° ê°•ì¡° */
.card.phone .model{
  font-size: clamp(18px, 4.8vw, 26px);
  font-weight: 900;
  margin-bottom: 10px;
}
.card.phone .price{
  font-size: clamp(30px, 7.2vw, 44px);
  font-weight: 900;
  margin-bottom: 8px;
}
.card.phone .sub{
  font-size: 13px;
  font-weight: 800;
  color: var(--ink);
  margin-top: 6px;
}

/* ì¤€ë¹„ì¤‘ ì¹´ë“œ */
.card--soon{
  opacity:.55;
  filter:grayscale(1);
  pointer-events:none;
}
.card--soon .model{
  display:flex;
  align-items:center;
  gap:8px;
}
.card--soon .soonIcon{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:26px;
  height:26px;
  border-radius:999px;
  border:1px solid #d1d5db;
  background:#fff;
  font-size:16px;
  line-height:1;
}

/* í•˜ë‹¨ */
.footer{
  position:fixed;left:0;right:0;bottom:0;
  background:#fff;border-top:1px solid var(--line);
}
.footer-msg{text-align:center;padding:10px;font-size:14px;font-weight:900;}
.footer-store{text-align:center;font-size:18px;font-weight:900;padding-bottom:6px;}
.footer-actions{display:grid;grid-template-columns:1fr 1fr 1fr;}
.footer-actions a{
  text-align:center;padding:16px 0;
  font-weight:900;text-decoration:none;color:#111;
}
.call{background:var(--call);color:#fff;}
.sms{background:var(--sms);color:#fff;}
.kakao{background:var(--kakao);}
</style>
</head>

<body>

<div class="neon-banner">
  <div class="neon-title">ì¸í„°ë„·TVÂ·ì•Œëœ°ìš”ê¸ˆì€ ì¹´í†¡ë¬¸ì˜</div>
  <div class="neon-points">
    <div class="neon-point">ğŸ’° ì¸í„°ë„·TV : <b>í˜„ê¸ˆ ìµœëŒ€ ì§€ì›</b></div>
    <div class="neon-point">ğŸ”¥ ì•Œëœ°ìš”ê¸ˆ : <b>ìµœì €ìš”ê¸ˆ 3,300ì›~</b></div>
  </div>
</div>

<!-- íƒ­: SK Â· KT Â· LG Â· í•«ë”œ Â· ì €ê°€ -->
<div class="tabs">
  <div class="tab active" data-tab="SK_PHONE">SK</div>
  <div class="tab" data-tab="KT_PHONE">KT</div>
  <div class="tab" data-tab="LG_PHONE">LG</div>
  <div class="tab" data-tab="HOT_DEAL">í•«ë”œ</div>
  <div class="tab" data-tab="LOW_PHONE">ì €ê°€</div>
</div>

<div class="main">
  <div class="grid" id="cards"></div>
</div>

<div class="footer">
  <div class="footer-msg">ì•¡ì •í•„ë¦„ ë¬´ë£Œêµì²´ (ì¹´í†¡ì£¼ë¬¸í•„ìˆ˜)</div>
  <div class="footer-store">ë³µì§€ê´€2ì¸µë§¤ì¥</div>
  <div class="footer-actions">
    <a class="call" href="tel:042-821-2272">ì „í™”</a>
    <a class="sms" href="sms:010-5839-1512">ë¬¸ì</a>
    <a class="kakao" href="https://open.kakao.com/o/s729bI5h" target="_blank" rel="noopener">ì¹´í†¡</a>
  </div>
</div>

<script>
const CSV_URL = 'data.csv?v=' + Date.now();
const grid = document.getElementById('cards');
const tabs = document.querySelectorAll('.tab');

/* ìš”ê¸ˆì œ í‘œê¸° */
const PHONE_PLAN = {
  SK: 'SK 109ìš”ê¸ˆ 6ê°œì›”',
  KT: 'KT 110ìš”ê¸ˆ 6ê°œì›”',
  LG: 'LG 115ìš”ê¸ˆ 6ê°œì›”'
};
const PHONE_EXTRA = 'ë¶€ê°€ë³„ë„ë¬¸ì˜';

function escapeHTML(str){
  return (str ?? '').toString()
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'","&#039;");
}

function parseCSV(text){
  const t = (text || '').replace(/\r/g,'');
  const rows=[], cur=[];
  let cell='', inQ=false;
  for(let i=0;i<t.length;i++){
    const c=t[i], n=t[i+1];
    if(c === '"' && n === '"'){ cell+='"'; i++; }
    else if(c === '"'){ inQ = !inQ; }
    else if(c === ',' && !inQ){ cur.push(cell); cell=''; }
    else if(c === '\n' && !inQ){
      cur.push(cell); rows.push([...cur]);
      cur.length=0; cell='';
    } else cell += c;
  }
  cur.push(cell); rows.push([...cur]);
  if(!rows.length) return [];
  const header = rows.shift().map(h => (h||'').trim());
  return rows
    .filter(r => r.some(v => (v||'').trim() !== ''))
    .map(r=>{
      const o={};
      header.forEach((h,i)=> o[h]=(r[i]??'').trim());
      return o;
    });
}

/* ìˆ«ì íŒŒì‹±: 0/ë§ˆì´ë„ˆìŠ¤ ê·¸ëŒ€ë¡œ í‘œê¸° */
function phonePrice(nStr){
  const n = Number(String(nStr||'').replace(/,/g,'').trim());
  if(!Number.isFinite(n)) return 'ë¬¸ì˜';
  return `${n}ë§Œì›`;
}

/* ì´ë™/ê¸°ë³€ ìˆ«ì ì¶”ì¶œ (ì½¤ë§ˆ/ì†Œìˆ˜/ë§ˆì´ë„ˆìŠ¤ ëŒ€ì‘) */
function getMoveChangeNums(display_price){
  const s = String(display_price||'');
  const m = s.match(/ì´ë™\s*([-\d.,]+)/);
  const g = s.match(/ê¸°ë³€\s*([-\d.,]+)/);
  const move = m ? Number(String(m[1]).replace(/,/g,'').trim()) : null;
  const change = g ? Number(String(g[1]).replace(/,/g,'').trim()) : null;
  return { move, change };
}

/* í•«ë”œ íŒì •: ì´ë™/ê¸°ë³€ ì¤‘ 0 ë˜ëŠ” ë§ˆì´ë„ˆìŠ¤ê°€ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ */
function isHotDealPhoneRow(r){
  if(r.type !== 'PHONE') return false;
  const { move, change } = getMoveChangeNums(r.display_price);
  const nums = [move, change].filter(v => Number.isFinite(v));
  if(!nums.length) return false;
  return nums.some(n => n <= 0);
}

/* âœ… ì¶”ì²œ ì •ë ¬ í‚¤: ì´ë™ ë§ˆì´ë„ˆìŠ¤ ìš°ì„  + ë§ˆì´ë„ˆìŠ¤ í° ìˆœ */
function hotDealSortKey(r){
  const { move, change } = getMoveChangeNums(r.display_price);

  // ê·¸ë£¹ ìš°ì„ ìˆœìœ„
  // 0) ì´ë™ ë§ˆì´ë„ˆìŠ¤
  // 1) ì´ë™ 0ì›
  // 2) ê¸°ë³€ ë§ˆì´ë„ˆìŠ¤
  // 3) ê¸°íƒ€
  if (Number.isFinite(move) && move < 0)  return { group: 0, value: move };
  if (Number.isFinite(move) && move === 0) return { group: 1, value: 0 };
  if (Number.isFinite(change) && change < 0) return { group: 2, value: change };

  const fallback = Number.isFinite(move) ? move : (Number.isFinite(change) ? change : 999999);
  return { group: 3, value: fallback };
}

/* ê³µí†µ ì¹´ë“œ ìƒì„± (showCarrier=trueë©´ í•«ë”œìš©: í†µì‹ ì‚¬/ìš”ê¸ˆì œ ë…¸ì¶œ) */
function phoneCards(r, showCarrier){
  const out=[];
  const { move, change } = getMoveChangeNums(r.display_price);
  const plan = PHONE_PLAN[r.carrier] || '';

  if(Number.isFinite(move)){
    out.push(`
      <div class="card phone">
        <div class="badge">${showCarrier ? `${escapeHTML(r.carrier)} íŠ¹ê°€ Â· ì´ë™` : 'ì´ë™'}</div>
        <div class="model">${escapeHTML(r.title)}</div>
        <div class="price">${phonePrice(move)}</div>
        <div class="sub">${escapeHTML(plan)}</div>
        <div class="sub">${escapeHTML(PHONE_EXTRA)}</div>
      </div>
    `);
  }
  if(Number.isFinite(change)){
    out.push(`
      <div class="card phone">
        <div class="badge">${showCarrier ? `${escapeHTML(r.carrier)} íŠ¹ê°€ Â· ê¸°ë³€` : 'ê¸°ë³€'}</div>
        <div class="model">${escapeHTML(r.title)}</div>
        <div class="price">${phonePrice(change)}</div>
        <div class="sub">${escapeHTML(plan)}</div>
        <div class="sub">${escapeHTML(PHONE_EXTRA)}</div>
      </div>
    `);
  }
  return out;
}

/* ì €ê°€ìš”ê¸ˆí°: 1í–‰=1ì¹´ë“œ (í‘œì‹œëŠ” ê°„ë‹¨í•˜ê²Œ ìœ ì§€) */
function lowOneCard(r){
  const plan = PHONE_PLAN[r.carrier] || '';
  return `
    <div class="card phone">
      <div class="badge">${escapeHTML(r.carrier)} Â· ì €ê°€ìš”ê¸ˆí°</div>
      <div class="model">${escapeHTML(r.title)}</div>
      <div class="price">${escapeHTML(r.display_price || '')}</div>
      <div class="sub">${escapeHTML(plan)}</div>
      <div class="sub">${escapeHTML(PHONE_EXTRA)}</div>
    </div>
  `;
}
function soonCard(){
  return `
    <div class="card phone card--soon">
      <div class="badge">ì¤€ë¹„ì¤‘</div>
      <div class="model"><span class="soonIcon">â³</span>ì €ê°€ìš”ê¸ˆí° ì¤€ë¹„ì¤‘</div>
      <div class="price">COMING</div>
      <div class="sub">ê³§ ì¶”ê°€ë©ë‹ˆë‹¤</div>
      <div class="sub">ì¹´í†¡ë¬¸ì˜</div>
    </div>
  `;
}

function filterRows(rows, tab){
  // ì¼ë°˜í°: í†µì‹ ì‚¬ íƒ­ì—ì„œëŠ” í•«ë”œ ì œì™¸
  if(tab==='SK_PHONE') return rows.filter(r=>r.type==='PHONE' && r.carrier==='SK' && !isHotDealPhoneRow(r));
  if(tab==='KT_PHONE') return rows.filter(r=>r.type==='PHONE' && r.carrier==='KT' && !isHotDealPhoneRow(r));
  if(tab==='LG_PHONE') return rows.filter(r=>r.type==='PHONE' && r.carrier==='LG' && !isHotDealPhoneRow(r));

  if(tab==='HOT_DEAL') return rows.filter(r=>isHotDealPhoneRow(r));
  if(tab==='LOW_PHONE') return rows.filter(r=>r.type==='PHONE_LOW');

  return [];
}

function render(tab){
  fetch(CSV_URL,{cache:'no-store'})
    .then(r=>r.text())
    .then(t=>{
      const rows = parseCSV(t);

      // âœ… íƒ­ ì „í™˜ë§ˆë‹¤ í•­ìƒ ì´ˆê¸°í™” (ê²¹ì¹¨ ë°©ì§€)
      grid.innerHTML = '';

      if(tab === 'LOW_PHONE'){
        const show = filterRows(rows, tab);
        show.forEach(r=> grid.innerHTML += lowOneCard(r));

        // í•­ìƒ 6ì¥: ë¶€ì¡±ë¶„ ì¤€ë¹„ì¤‘
        const count = show.length;
        for(let i=0;i<Math.max(0, 6-count);i++){
          grid.innerHTML += soonCard();
        }
        if(!grid.innerHTML.trim()){
          grid.innerHTML = `
            <div class="card" style="grid-column:1 / -1;">
              <div class="model">í‘œì‹œí•  í•­ëª© ì—†ìŒ</div>
              <div class="sub">data.csvì— ì €ê°€ìš”ê¸ˆí° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
          `;
        }
        return;
      }

      if(tab === 'HOT_DEAL'){
        const show = filterRows(rows, tab)
          .map((r, idx)=>({r, idx}))
          .sort((a,b)=>{
            const ak = hotDealSortKey(a.r);
            const bk = hotDealSortKey(b.r);
            if(ak.group !== bk.group) return ak.group - bk.group;
            if(ak.value !== bk.value) return ak.value - bk.value; // -20ì´ ìœ„
            return a.idx - b.idx;
          })
          .map(x=>x.r);

        show.forEach(r=>{
          phoneCards(r, true).forEach(h=> grid.innerHTML += h);  // âœ… í•«ë”œ: í†µì‹ ì‚¬/ìš”ê¸ˆì œ í‘œì‹œ
        });

        if(!grid.innerHTML.trim()){
          grid.innerHTML = `
            <div class="card" style="grid-column:1 / -1;">
              <div class="model">í‘œì‹œí•  í•­ëª© ì—†ìŒ</div>
              <div class="sub">í˜„ì¬ í•«ë”œ ì¡°ê±´(0/ë§ˆì´ë„ˆìŠ¤)ì— í•´ë‹¹í•˜ëŠ” í°ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
          `;
        }
        return;
      }

      // SK/KT/LG ì¼ë°˜
      const show = filterRows(rows, tab);
      show.forEach(r=>{
        phoneCards(r, false).forEach(h=> grid.innerHTML += h); // í†µì‹ ì‚¬ í‘œì‹œëŠ” ìˆ¨ê¹€, ìš”ê¸ˆì œëŠ” í‘œì‹œ
      });

      if(!grid.innerHTML.trim()){
        grid.innerHTML = `
          <div class="card" style="grid-column:1 / -1;">
            <div class="model">í‘œì‹œí•  í•­ëª© ì—†ìŒ</div>
            <div class="sub">data.csvì— íœ´ëŒ€í° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>
          </div>
        `;
      }
    });
}

/* íƒ­ í´ë¦­ */
tabs.forEach(t=>{
  t.onclick=()=>{
    tabs.forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    render(t.dataset.tab);
  };
});

/* ì´ˆê¸° í™”ë©´ */
render('SK_PHONE');
</script>

</body>
</html>
