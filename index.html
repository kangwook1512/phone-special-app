<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>복지관 2층 휴대폰 매장 | 특판 전용 사이트</title>
  <meta name="description" content="복지관 2층 휴대폰 매장 특판 전용 사이트. SK·KT·LG 휴대폰 특판, 인터넷·TV 현금 지원, 알뜰요금 3,300원~ 안내. 문의는 카톡으로." />

  <style>
    :root{
      /* 요즘 톤 */
      --bgBase:#F6F7FB;
      --ink:#0b1220;
      --muted:#556070;
      --muted2:#7b8698;

      --card:#ffffff;
      --stroke:rgba(15,23,42,.08);
      --shadow:0 14px 32px rgba(20,30,60,.12);
      --radius:16px;

      --brand1:#4F46E5;  /* 인디고 */
      --brand2:#22D3EE;  /* 시안 */
      --accent:#111827;

      /* 고정 하단바 */
      --bottomBarH:72px;

      /* 상단 간판 높이 과한 것 방지 */
      --heroPad:12px;
      --containerMax:980px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(900px 520px at 15% 10%, rgba(79,70,229,.10), transparent 60%),
        radial-gradient(900px 520px at 85% 30%, rgba(34,211,238,.08), transparent 60%),
        var(--bgBase);
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }

    /* 화면 꽉 차는 골격 */
    .app{
      min-height:100svh;
      display:flex;
      flex-direction:column;
    }

    .wrap{
      width:100%;
      max-width:var(--containerMax);
      margin:0 auto;
      padding:0 12px;
    }

    /* 상단 간판(과하게 크지 않게) */
    header{
      padding: var(--heroPad) 0 10px;
    }

    .hero{
      background: rgba(255,255,255,.70);
      border:1px solid rgba(15,23,42,.06);
      box-shadow: 0 10px 24px rgba(20,30,60,.08);
      border-radius: 18px;
      padding: 12px 12px;
      backdrop-filter: blur(10px);
    }

    .heroTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }

    .brandTitle{
      line-height:1.15;
    }
    .brandTitle .t1{
      font-size: 14px;
      font-weight: 900;
      color: var(--muted);
      letter-spacing: -0.2px;
    }
    .brandTitle .t2{
      font-size: 20px;
      font-weight: 950;
      letter-spacing: -0.6px;
      margin-top: 4px;
      color: var(--ink);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      color:#fff;
      background: linear-gradient(135deg, var(--brand1), var(--brand2));
      box-shadow: 0 14px 28px rgba(79,70,229,.18);
      white-space:nowrap;
      user-select:none;
    }

    .heroNote{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }

    .noteChip{
      border-radius: 12px;
      padding: 8px 10px;
      background:#fff;
      border:1px solid rgba(15,23,42,.07);
      color: var(--muted);
      font-weight: 850;
      font-size: 13px;
      box-shadow: 0 10px 22px rgba(20,30,60,.08);
    }
    .noteChip b{
      color: var(--ink);
      font-weight: 950;
    }

    /* 탭(한 줄 스크롤) */
    .tabs{
      margin-top: 10px;
      display:flex;
      gap:8px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      padding-bottom: 2px;
    }
    .tabs::-webkit-scrollbar{ display:none; }

    .tab{
      flex:0 0 auto;
      border-radius: 999px;
      padding: 10px 12px;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(255,255,255,.75);
      color: var(--ink);
      font-weight: 950;
      font-size: 13px;
      cursor:pointer;
      user-select:none;
      transition: transform .05s ease, background .2s ease, border-color .2s ease;
      white-space:nowrap;
    }
    .tab:active{ transform: scale(.98); }
    .tab.active{
      border-color: transparent;
      color:#fff;
      background: linear-gradient(135deg, var(--brand1), var(--brand2));
      box-shadow: 0 14px 28px rgba(79,70,229,.18);
    }

    /* 메인 콘텐츠: 하단바 만큼 여백 확보 */
    main{
      flex:1 1 auto;
      padding: 10px 0 0;
    }
    .mainPad{
      padding-bottom: calc(var(--bottomBarH) + env(safe-area-inset-bottom) + 14px);
    }

    /* 카드 그리드 */
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      padding: 12px 0 18px;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .cardBody{
      padding: 12px 12px 12px;
    }

    .row1{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }

    .cardTitle{
      font-size: 16px;
      font-weight: 950;
      letter-spacing: -0.4px;
      margin: 0;
      line-height: 1.2;
    }

    .cardSub{
      margin-top: 6px;
      font-size: 13px;
      color: var(--muted);
      font-weight: 800;
      letter-spacing: -0.1px;
      line-height:1.3;
    }

    .priceBox{
      text-align:right;
      min-width: 112px;
    }
    .priceLabel{
      font-size: 11px;
      font-weight: 900;
      color: var(--muted2);
      margin-bottom: 4px;
    }
    .price{
      font-size: 20px;
      font-weight: 1000;
      letter-spacing: -0.8px;
      color: var(--brand1);
      line-height: 1.05;
      white-space:nowrap;
    }

    .badges{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top: 10px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 8px 10px;
      border-radius: 999px;
      font-weight: 950;
      font-size: 12px;
      border: 1px solid rgba(15,23,42,.08);
      background: rgba(246,247,251,.75);
      color: var(--ink);
      user-select:none;
    }
    .badge.hot{
      border: none;
      color:#fff;
      background: linear-gradient(135deg, #ef4444, #f97316);
      box-shadow: 0 12px 24px rgba(239,68,68,.18);
    }

    .desc{
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted);
      font-weight: 800;
      line-height: 1.35;
      white-space: pre-line;
    }

    .meta{
      margin-top: 10px;
      font-size: 11px;
      color: var(--muted2);
      font-weight: 800;
    }

    /* 빈 상태 */
    .empty{
      background: rgba(255,255,255,.75);
      border:1px dashed rgba(15,23,42,.18);
      border-radius: 18px;
      padding: 14px;
      color: var(--muted);
      font-weight: 900;
      box-shadow: 0 10px 22px rgba(20,30,60,.08);
      margin: 12px 0 18px;
    }
    .empty b{ color:var(--ink); }

    /* 고정 하단바 */
    .bottom-bar{
      position:fixed;
      left:0; right:0; bottom:0;
      padding: 10px 12px;
      padding-bottom: calc(10px + env(safe-area-inset-bottom));
      background: rgba(246,247,251,.84);
      backdrop-filter: blur(12px);
      border-top: 1px solid rgba(15,23,42,.08);
      z-index:9999;
    }
    .bottom-actions{
      width:100%;
      max-width:var(--containerMax);
      margin:0 auto;
      display:grid;
      grid-template-columns: 1fr 1fr 1.25fr; /* 카톡을 조금 더 크게 */
      gap:10px;
    }
    .bbtn{
      height:52px;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.10);
      background:#fff;
      box-shadow: 0 10px 22px rgba(20,30,60,.10);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 950;
      text-decoration:none;
      color: var(--ink);
      letter-spacing:-0.2px;
      user-select:none;
    }
    .bbtn:active{ transform: scale(.99); }
    .bbtn small{
      font-weight: 850;
      color: var(--muted);
      margin-left: 6px;
    }
    .bbtn.kakao{
      border:none;
      color:#fff;
      background: linear-gradient(135deg, var(--brand1), var(--brand2));
      box-shadow: 0 18px 34px rgba(79,70,229,.22);
    }

    /* 데스크톱에서는 그리드 2열 */
    @media (min-width: 820px){
      .grid{ grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>

<body>
<div class="app">

  <header>
    <div class="wrap">
      <div class="hero">
        <div class="heroTop">
          <div class="brandTitle">
            <div class="t1">복지관 2층</div>
            <div class="t2">휴대폰 매장 · 특판 전용 사이트</div>
          </div>
          <div class="pill">문의는 카톡이 제일 빠름</div>
        </div>

        <div class="heroNote">
          <div class="noteChip"><b>액정필름 무료교체</b> (카톡주문필수)</div>
          <div class="noteChip">휴대폰 · 인터넷TV · 알뜰요금 <b>한 번에</b></div>
        </div>

        <div class="tabs" id="tabs"></div>
      </div>
    </div>
  </header>

  <main class="mainPad">
    <div class="wrap">
      <div id="status" class="empty" style="display:none;"></div>
      <div class="grid" id="grid"></div>
    </div>
  </main>

</div>

<!-- 고정 하단바 -->
<div class="bottom-bar">
  <div class="bottom-actions">
    <a class="bbtn" href="tel:042-821-2272">전화 <small>042-821-2272</small></a>
    <a class="bbtn" href="sms:010-5839-1512">문자 <small>010-5839-1512</small></a>
    <a class="bbtn kakao" href="https://open.kakao.com/o/s729bI5h" target="_blank" rel="noopener">카톡 문의</a>
  </div>
</div>

<script>
/**
 * data.csv 형식 (권장 헤더 예시)
 * category,title,subtitle,price,badge,desc,updated,priority
 *
 * category: SK | KT | LG | 인터넷TV | 알뜰요금
 * price: 예) 0원 / 34만원 / 월 3,300원~
 * badge: 예) HOT / 오늘특가 / 0원가능 등
 * priority: 숫자 (높을수록 위)
 *
 * 헤더 이름이 달라도 최대한 유사하게 매핑합니다.
 */

const CATEGORIES = [
  { key: "SK", label: "SK" },
  { key: "KT", label: "KT" },
  { key: "LG", label: "LG" },
  { key: "인터넷TV", label: "인터넷TV" },
  { key: "알뜰요금", label: "알뜰요금" }
];

const FALLBACK_ROWS = [
  {
    category:"알뜰요금",
    title:"LG망 무제한",
    subtitle:"통화/문자 무제한 · 50분/50건 · 조건별",
    price:"월 3,300원~",
    badge:"HOT",
    desc:"가입비/유심 등 추가비용 일체 없음\n문의는 카톡으로 남겨주세요.",
    updated:"업데이트: 예시"
  },
  {
    category:"인터넷TV",
    title:"인터넷 + TV 결합",
    subtitle:"설치 가능 지역/조건 확인 필요",
    price:"현금 최대 지급",
    badge:"문의",
    desc:"정확한 지원금은 조건(지역/결합/요금제) 따라 변동됩니다.\n카톡으로 주소/통신사/희망상품 보내주세요.",
    updated:"업데이트: 예시"
  },
  {
    category:"SK",
    title:"갤럭시/아이폰 특판",
    subtitle:"기기/요금제/번호이동 조건별",
    price:"0원~",
    badge:"HOT",
    desc:"당일 시세 변동 가능\n카톡 문의 시 최저가 라인 안내",
    updated:"업데이트: 예시"
  },
  {
    category:"KT",
    title:"신규/기변/번이",
    subtitle:"모델별 상이",
    price:"문의",
    badge:"상담",
    desc:"원하시는 모델/색상/용량 보내주시면 바로 정리해드립니다.",
    updated:"업데이트: 예시"
  },
  {
    category:"LG",
    title:"요금제/지원금 최적",
    subtitle:"조건 맞춤형",
    price:"문의",
    badge:"상담",
    desc:"가능한 조합 중 ‘실구매가’ 기준으로 최적 안내",
    updated:"업데이트: 예시"
  }
];

let allRows = [];
let activeCategory = CATEGORIES[0].key;

init();

async function init(){
  renderTabs();
  await loadCSV();
  render();
}

function renderTabs(){
  const el = document.getElementById("tabs");
  el.innerHTML = "";
  CATEGORIES.forEach(c => {
    const b = document.createElement("button");
    b.className = "tab" + (c.key === activeCategory ? " active" : "");
    b.textContent = c.label;
    b.onclick = () => {
      activeCategory = c.key;
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      b.classList.add("active");
      render();
    };
    el.appendChild(b);
  });
}

async function loadCSV(){
  try{
    const res = await fetch("data.csv", { cache: "no-store" });
    if(!res.ok) throw new Error("CSV HTTP " + res.status);
    const text = await res.text();
    const rows = parseCSV(text);
    allRows = normalizeRows(rows);

    // CSV가 있는데 실데이터가 거의 없을 때(헤더만 있거나 공백) 대비
    if(!allRows.length){
      allRows = FALLBACK_ROWS;
      setStatus("data.csv는 읽혔지만 내용이 비어있어 예시 카드로 표시 중입니다. <b>CSV 내용을 채우면 자동 반영</b>됩니다.");
    }else{
      setStatus(""); // 정상은 숨김
    }
  }catch(e){
    allRows = FALLBACK_ROWS;
    setStatus("data.csv를 불러오지 못해 예시 카드로 표시 중입니다. <b>index.html과 같은 폴더에 data.csv 업로드</b> 후 새로고침하세요.");
  }
}

function setStatus(html){
  const s = document.getElementById("status");
  if(!html){
    s.style.display = "none";
    s.innerHTML = "";
    return;
  }
  s.style.display = "block";
  s.innerHTML = html;
}

function render(){
  const grid = document.getElementById("grid");

  const rows = allRows
    .filter(r => (r.category || "").trim() === activeCategory)
    .sort((a,b) => (toNum(b.priority) - toNum(a.priority)));

  if(!rows.length){
    grid.innerHTML = "";
    const div = document.createElement("div");
    div.className = "empty";
    div.innerHTML = `현재 <b>${activeCategory}</b> 카테고리에 등록된 카드가 없습니다.<br/>data.csv에 해당 카테고리 행을 추가하면 바로 표시됩니다.`;
    grid.appendChild(div);
    return;
  }

  grid.innerHTML = "";
  rows.forEach(r => grid.appendChild(cardEl(r)));
}

function cardEl(r){
  const card = document.createElement("section");
  card.className = "card";

  const badge = (r.badge || "").trim();
  const isHot = /hot|특가|0원|초특가|강추/i.test(badge);

  card.innerHTML = `
    <div class="cardBody">
      <div class="row1">
        <div>
          <h3 class="cardTitle">${escapeHTML(r.title || "제목 없음")}</h3>
          ${r.subtitle ? `<div class="cardSub">${escapeHTML(r.subtitle)}</div>` : ``}
        </div>
        <div class="priceBox">
          <div class="priceLabel">${escapeHTML(r.category || "")}</div>
          <div class="price">${escapeHTML(r.price || "문의")}</div>
        </div>
      </div>

      <div class="badges">
        ${badge ? `<span class="badge ${isHot ? "hot":""}">${escapeHTML(badge)}</span>` : ``}
        ${r.tag ? `<span class="badge">${escapeHTML(r.tag)}</span>` : ``}
      </div>

      ${r.desc ? `<div class="desc">${escapeHTML(r.desc)}</div>` : ``}
      ${r.updated ? `<div class="meta">${escapeHTML(r.updated)}</div>` : ``}
    </div>
  `;
  return card;
}

/* ---------------- CSV 파서(간단/안전) ---------------- */

function parseCSV(text){
  // 줄 단위 파싱 (따옴표 포함 기본 지원)
  const lines = text.replace(/\r/g, "").split("\n").filter(l => l.trim().length);
  if(!lines.length) return [];

  const header = splitCSVLine(lines[0]).map(h => h.trim());
  const out = [];

  for(let i=1;i<lines.length;i++){
    const cols = splitCSVLine(lines[i]);
    const obj = {};
    header.forEach((h, idx) => obj[h] = (cols[idx] ?? "").trim());
    out.push(obj);
  }
  return out;
}

function splitCSVLine(line){
  const result = [];
  let cur = "";
  let inQuotes = false;

  for(let i=0;i<line.length;i++){
    const ch = line[i];

    if(ch === '"'){
      if(inQuotes && line[i+1] === '"'){ // escaped quote
        cur += '"';
        i++;
      }else{
        inQuotes = !inQuotes;
      }
    }else if(ch === "," && !inQuotes){
      result.push(cur);
      cur = "";
    }else{
      cur += ch;
    }
  }
  result.push(cur);
  return result;
}

/* ---------------- 헤더 유연 매핑 ---------------- */

function normalizeRows(rows){
  if(!rows || !rows.length) return [];

  // 헤더 후보군(여러 형태 허용)
  const map = {
    category: ["category","카테고리","통신사","망","carrier","type"],
    title: ["title","상품","모델","제목","name"],
    subtitle: ["subtitle","부제","조건","요약","sub","detail1"],
    price: ["price","가격","월요금","요금","실구매가","지원금","금액","money"],
    badge: ["badge","뱃지","태그","구분","label"],
    desc: ["desc","설명","비고","메모","detail","detail2"],
    updated: ["updated","업데이트","날짜","date","time"],
    priority: ["priority","우선순위","rank","sort"]
  };

  function pick(obj, keys){
    for(const k of keys){
      if(Object.prototype.hasOwnProperty.call(obj, k)) return obj[k];
    }
    return "";
  }

  const cleaned = rows.map(o => ({
    category: pick(o, map.category),
    title: pick(o, map.title),
    subtitle: pick(o, map.subtitle),
    price: pick(o, map.price),
    badge: pick(o, map.badge),
    desc: pick(o, map.desc),
    updated: pick(o, map.updated),
    priority: pick(o, map.priority),
    // 추가로 남기고 싶으면 여기에 확장
    tag: ""
  }))
  .map(r => ({
    ...r,
    category: normalizeCategory(r.category),
    priority: r.priority || "0"
  }))
  .filter(r => r.category); // 카테고리 없는 행 제거

  return cleaned;
}

function normalizeCategory(v){
  const s = (v || "").trim();
  if(!s) return "";

  // 흔한 표기 보정
  if(/^sk$/i.test(s) || s.includes("SK")) return "SK";
  if(/^kt$/i.test(s) || s.includes("KT")) return "KT";
  if(/^lg$/i.test(s) || s.includes("LG")) return "LG";
  if(s.includes("인터넷") || s.includes("tv") || s.includes("TV")) return "인터넷TV";
  if(s.includes("알뜰") || s.includes("mvno") || s.includes("MVNO")) return "알뜰요금";

  // 그대로 쓰되, 우리가 가진 탭과 다르면 노출 안 됨
  // (원하면 탭에 추가 가능)
  return s;
}

function toNum(v){
  const n = parseFloat(String(v || "0").replace(/[^\d.-]/g,""));
  return isNaN(n) ? 0 : n;
}

function escapeHTML(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
</script>
</body>
</html>
