<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

<title>국과연특판 | 복지관2층매장</title>
<meta name="description" content="국과연특판 · 복지관2층매장 특가폰/알뜰요금/인터넷TV 안내. 카톡문의로 빠르게 상담 가능합니다." />
<link rel="canonical" href="https://a2272a.github.io/" />
<meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />

<meta property="og:type" content="website" />
<meta property="og:title" content="국과연특판 | 복지관2층매장" />
<meta property="og:description" content="국과연특판 · 특가폰/알뜰요금/인터넷TV 안내. 카톡문의로 빠르게 상담." />
<meta property="og:url" content="https://a2272a.github.io/" />
<meta name="twitter:card" content="summary" />

<link rel="manifest" href="./manifest.json" />

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": "국과연특판 복지관2층매장",
  "url": "https://a2272a.github.io/",
  "telephone": "+82-42-821-2272",
  "description": "국과연특판 · 복지관2층매장 특가폰/알뜰요금/인터넷TV 안내. 카톡문의로 상담.",
  "sameAs": ["https://open.kakao.com/o/s729bI5h"]
}
</script>

<style>
:root{
  --bg:#f5f6f8; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb;
  --sk:#2563eb; --kt:#111827; --lg:#16a34a; --hot:#f97316; --low:#7c3aed;
  --call:#22c55e; --sms:#38bdf8; --kakao:#fee500;

  --ledBg:#070b12; --ledBg2:#0b1220; --ledBorder:rgba(255,255,255,.14);
  --ledText:#f8fffc;

  /* 팝업(A안) */
  --adBg1:#060a12;
  --adBg2:#0a1220;
  --adGlow: rgba(0,255,180,.55);
  --adGlow2: rgba(0,255,180,.22);
}
*{box-sizing:border-box;}
html,body{margin:0;padding:0;}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",system-ui,sans-serif;
  background:var(--bg); color:var(--ink);
}
.wrap{max-width:760px;margin:0 auto;padding:14px 14px 190px;}

/* hero */
.hero{
  border-radius:18px;
  overflow:hidden;
  position:relative;
  background:
    radial-gradient(900px 160px at 50% 0%, rgba(0,255,180,.10), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.05) 0%, rgba(0,0,0,.22) 100%),
    linear-gradient(90deg, var(--ledBg) 0%, var(--ledBg2) 50%, var(--ledBg) 100%);
  border:1px solid var(--ledBorder);
  box-shadow:0 14px 34px rgba(0,0,0,.18), 0 0 0 2px rgba(255,255,255,.10);
}
.heroMarquee2{min-height:52px;display:flex;align-items:center;padding:10px 12px;position:relative;}
.heroMarquee2::before{
  content:"";position:absolute; inset:0;
  background: radial-gradient(circle, rgba(255,255,255,.08) 1px, transparent 1.9px);
  background-size: 8px 8px;opacity:.22;pointer-events:none;
}
.marqueeLine{
  width:100%;
  height:auto;
  display:flex;align-items:center;justify-content:space-between;overflow:hidden;
  padding:6px 10px;border-radius:14px;background: rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.10);box-shadow: inset 0 12px 20px rgba(0,0,0,.34);
  gap:10px;
}
.marqueeInner{
  display:flex;align-items:center;min-width:0;flex:1;
}

/* 업데이트 문구 */
.updateWrap{
  display:flex;
  align-items:center;
  gap:14px;
  min-width:0;
  width:100%;
}
.updateWrap .line1,
.updateWrap .line2{
  font-size:18px;
  font-weight:1000;
  letter-spacing:-.6px;
  color:var(--ledText);
  text-shadow:0 0 12px rgba(0,255,180,.70), 0 0 26px rgba(0,255,180,.40), 0 2px 14px rgba(0,0,0,.85);
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  min-width:0;
}
@media (max-width:480px){
  .updateWrap{
    flex-direction:column;
    align-items:flex-start;
    gap:2px;
  }
  .updateWrap .line1,
  .updateWrap .line2{
    font-size:16px;
    white-space:normal;
  }
}

/* 관리자 새로고침 버튼(기본 숨김) */
.heroRefreshBtn{
  flex:0 0 auto;
  height:28px;
  padding:0 10px;
  border-radius:999px;
  border:1px solid rgba(0,255,180,.35);
  background:rgba(0,255,180,.10);
  color:var(--ledText);
  font-weight:1000;
  font-size:12px;
  cursor:pointer;
  text-shadow:0 0 10px rgba(0,255,180,.55);
  display:none;
}
.heroRefreshBtn:active{transform:translateY(1px);filter:brightness(.98);}

/* tabs */
.tabs{display:flex;gap:8px;margin-top:12px;}
.tabBtn{
  flex:1;padding:12px 0;border-radius:999px;border:1px solid var(--line);
  background:#fff;font-weight:1000;font-size:14px;cursor:pointer;
}
.tabBtn.active{color:#fff;border-color:transparent;}
.tabBtn.sk.active{background:var(--sk);}
.tabBtn.kt.active{background:var(--kt);}
.tabBtn.lg.active{background:var(--lg);}
.tabBtn.svc{font-size:15px;font-weight:1000;}
.tabBtn.svc.mvno.active{background:var(--lg);}
.tabBtn.svc.internet.active{background:var(--kt);}

.panel{margin-top:14px;background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px;}

/* sub tabs */
.subTabs{display:none;gap:8px;margin:0 0 12px;}
.subTabs.show{ display:flex; }
.subTabBtn{
  flex:1;padding:10px 0;border-radius:999px;border:1px solid var(--line);
  background:#fff;font-weight:1000;font-size:14px;cursor:pointer;
}
.subTabBtn.active{ color:#fff; border-color:transparent; }
.subTabBtn.sk.active{ background:var(--sk); }
.subTabBtn.kt.active{ background:var(--kt); }
.subTabBtn.lg.active{ background:var(--lg); }

.list{display:grid;grid-template-columns:repeat(2, minmax(0, 1fr));gap:10px;}
@media (max-width: 420px){ .list{ grid-template-columns:1fr; } }

.card{border:1px solid var(--line);border-radius:14px;padding:12px;box-shadow:0 2px 10px rgba(0,0,0,.05);}
.titleRow{display:flex;justify-content:space-between;margin-bottom:8px;gap:10px;align-items:center;}
.model{font-weight:1000;font-size:16px;letter-spacing:-.2px;}
.badge{font-size:12px;font-weight:1000;padding:6px 10px;border-radius:999px;color:#fff;white-space:nowrap;}
.badge.sk{background:var(--sk);} .badge.kt{background:var(--kt);} .badge.lg{background:var(--lg);}
.badge.hot{background:var(--hot);} .badge.low{background:var(--low);}

.infoLine{font-size:12px;font-weight:1000;color:var(--muted);margin:0 0 6px;}
.discountLine{font-size:12px;font-weight:1000;color:#2563eb;margin:0 0 8px;}

/* price row */
.priceRow{
  display:grid;
  grid-template-columns:repeat(2, minmax(0, 1fr));
  gap:10px;
}
.priceRow.one{ grid-template-columns:1fr; }

.pill{border:1px solid var(--line);border-radius:12px;padding:10px;text-align:center;background:#fafafa;min-width:0;}
.pill .k{font-size:12px;color:var(--muted);font-weight:1000;margin-bottom:4px;}
.pill .v{font-size:20px;font-weight:1000;letter-spacing:-.4px;}
.neg{color:#dc2626;} .zero{color:#0ea5e9;} .pos{color:#0f172a;}

.planLine{font-size:13px;font-weight:1000;letter-spacing:-.2px;margin:0 0 8px;color:#0f172a;line-height:1.25;}
.moneyRow{display:flex;justify-content:space-between;align-items:baseline;gap:10px;}
.moneyRow .label{font-size:12px;font-weight:1000;color:var(--muted);}
.moneyRow .val{font-size:22px;font-weight:1000;letter-spacing:-.4px;color:#0f172a;}
.moneyRow .val2{font-size:19px;font-weight:1000;letter-spacing:-.4px;color:#0f172a;}

.loading{grid-column:1/-1;padding:18px;text-align:center;font-weight:1000;color:#64748b;}

/* notice card */
.noticeCard{
  grid-column:1/-1;
  padding:10px 12px;
  border-radius:14px;
  background: linear-gradient(180deg, rgba(15,23,42,.04), rgba(15,23,42,.02));
}
.noticeCard .row{display:flex; align-items:center; justify-content:space-between; gap:10px;}
.noticeCard .twrap{display:flex;flex-direction:column;gap:4px;}
.noticeCard .t1{font-size:13px;font-weight:1000;letter-spacing:-.2px;color:#0f172a;line-height:1.2;}
.noticeCard .t2{font-size:12px;font-weight:1000;letter-spacing:-.2px;color:var(--muted);line-height:1.2;}
.noticeCard a{
  flex:0 0 auto;
  text-decoration:none;font-weight:1000;font-size:13px;padding:8px 10px;border-radius:12px;
  background:rgba(254,229,0,.35);border:1px solid rgba(254,229,0,.55);color:#3b2f00;
}

/* addon */
.addonCard{
  grid-column:1/-1;
  padding:14px;
  border-radius:14px;
  border:1px solid rgba(15,23,42,.12);
  background: linear-gradient(180deg, rgba(15,23,42,.03), rgba(15,23,42,.015));
}
.addonHead{display:flex;align-items:center;justify-content:space-between;gap:10px;cursor:pointer;user-select:none;}
.addonTitle{font-size:16px;font-weight:1000;letter-spacing:-.2px;color:#0f172a;}
.addonPill{font-size:13px;font-weight:1000;padding:7px 11px;border-radius:999px;color:#fff;white-space:nowrap;}
.addonPill.sk{background:var(--sk);} .addonPill.kt{background:var(--kt);} .addonPill.lg{background:var(--lg);}
.addonBtn{border:1px solid rgba(15,23,42,.14);background:#fff;padding:10px 12px;border-radius:12px;font-weight:1000;font-size:14px;cursor:pointer;}
.addonBody{margin-top:12px;display:none;}
.addonBody.show{display:block;}
.addonList{margin:0;padding-left:18px;}
.addonList li{margin:10px 0;font-size:15px;font-weight:1000;color:#0f172a;line-height:1.25;}
.addonList .sub{margin-top:4px;font-size:14px;font-weight:1000;color:var(--muted);}

/* bottom dock */
.bottomDock{
  position:fixed;left:12px;right:12px;bottom:calc(10px + env(safe-area-inset-bottom));
  height:60px;padding:8px;display:flex;gap:10px;border-radius:18px;
  background:rgba(255,255,255,.88);border:1px solid rgba(15,23,42,.10);
  box-shadow:0 14px 34px rgba(15,23,42,.14);backdrop-filter: blur(10px) saturate(160%);
  z-index:999;
}
.dockBtn{
  flex:1;display:flex;align-items:center;justify-content:center;gap:8px;border-radius:14px;
  text-decoration:none;font-weight:1000;font-size:16px;letter-spacing:-.2px;
  border:1px solid rgba(15,23,42,.10);background:#fff;color:#0f172a;
  box-shadow:0 8px 18px rgba(15,23,42,.08);
}
.dockBtn:active{transform: translateY(1px);box-shadow:0 6px 14px rgba(15,23,42,.10);filter: brightness(.98);}
.dockBtn svg{width:20px;height:20px;stroke: currentColor;stroke-width:2.4;fill:none;stroke-linecap:round;stroke-linejoin:round;}
.dockBtn.call{background:rgba(34,197,94,.12);border-color:rgba(34,197,94,.22);color:#0b3a22;}
.dockBtn.sms{background:rgba(56,189,248,.12);border-color:rgba(56,189,248,.22);color:#083244;}
.dockBtn.kakao{background:rgba(254,229,0,.35);border-color:rgba(254,229,0,.55);color:#3b2f00;}

/* =========================
   A안: 성지/홈쇼핑형 팝업
   ========================= */
.adBackdrop{
  position:fixed; inset:0;
  background: rgba(0,0,0,.62);
  opacity:0; pointer-events:none;
  transition: opacity .18s ease;
  z-index:2000;
}
.adModal{
  position:fixed; inset:0;
  display:flex; align-items:flex-end; justify-content:center;
  padding: 14px 12px calc(14px + env(safe-area-inset-bottom));
  opacity:0; pointer-events:none;
  transition: opacity .18s ease;
  z-index:2001;
}
.adModal.show, .adBackdrop.show{ opacity:1; pointer-events:auto; }

.adSheet{
  width:min(720px, 100%);
  border-radius:22px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.12);
  box-shadow:
    0 24px 70px rgba(0,0,0,.55),
    0 0 0 2px rgba(255,255,255,.08),
    0 0 36px var(--adGlow2);
  background:
    radial-gradient(900px 220px at 50% 0%, rgba(0,255,180,.14), transparent 55%),
    linear-gradient(180deg, rgba(255,255,255,.06) 0%, rgba(0,0,0,.18) 45%, rgba(0,0,0,.28) 100%),
    linear-gradient(90deg, var(--adBg1) 0%, var(--adBg2) 50%, var(--adBg1) 100%);
  transform: translateY(16px);
  transition: transform .22s ease;
}
.adModal.show .adSheet{ transform: translateY(0); }

.adTopBar{
  padding:14px 14px 12px;
  position:relative;
}
.adTopBar::before{
  content:"";
  position:absolute; inset:0;
  background: radial-gradient(circle, rgba(255,255,255,.08) 1px, transparent 1.9px);
  background-size: 8px 8px;
  opacity:.18;
  pointer-events:none;
}
.adTopRow{
  position:relative;
  display:flex; align-items:center; justify-content:space-between; gap:10px;
}
.adTitleWrap{display:flex;flex-direction:column;gap:6px;min-width:0;}
.adTitle1{
  font-weight:1000;
  letter-spacing:-.8px;
  color:var(--ledText);
  text-shadow: 0 0 14px rgba(0,255,180,.75), 0 0 26px rgba(0,255,180,.35), 0 2px 14px rgba(0,0,0,.85);
  font-size:18px;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.adTitle2{
  font-weight:1000;
  letter-spacing:-.4px;
  color:rgba(248,255,252,.86);
  font-size:13px;
  text-shadow: 0 0 10px rgba(0,255,180,.35);
}
.adClose{
  width:40px; height:40px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  color: rgba(248,255,252,.92);
  cursor:pointer;
  display:inline-flex; align-items:center; justify-content:center;
  box-shadow: inset 0 14px 22px rgba(0,0,0,.35);
}
.adClose:active{transform: translateY(1px); filter:brightness(.98);}

.adBody{
  padding: 6px 14px 14px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.adHeroCard{
  border-radius:18px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.05);
  box-shadow: inset 0 18px 28px rgba(0,0,0,.35), 0 0 0 2px rgba(0,255,180,.08);
  padding:14px;
}
.adBadgeRow{display:flex; align-items:center; justify-content:space-between; gap:10px;}
.adTag{
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-weight:1000;
  font-size:12px;
  padding:7px 10px;
  border-radius:999px;
  color: rgba(248,255,252,.95);
  border: 1px solid rgba(0,255,180,.35);
  background: rgba(0,255,180,.10);
  text-shadow: 0 0 10px rgba(0,255,180,.55);
}
.adCarrierPill{
  font-weight:1000;
  font-size:12px;
  padding:7px 10px;
  border-radius:999px;
  color:#fff;
}
.adCarrierPill.sk{background: var(--sk);}
.adCarrierPill.kt{background: var(--kt);}
.adCarrierPill.lg{background: var(--lg);}

.adModel{
  margin-top:10px;
  font-weight:1000;
  letter-spacing:-1px;
  color: var(--ledText);
  text-shadow: 0 0 16px rgba(0,255,180,.55), 0 2px 18px rgba(0,0,0,.85);
  font-size:26px;
  line-height:1.15;
  word-break:keep-all;
}
@media (max-width:420px){
  .adModel{font-size:24px;}
}

.adInfo{
  margin:8px 0 0;
  font-size:13px;
  font-weight:1000;
  letter-spacing:-.2px;
  color: rgba(248,255,252,.82);
}
.adDisc{
  margin:6px 0 0;
  font-size:13px;
  font-weight:1000;
  color: rgba(147,197,253,.95);
}

.adPrices{
  display:grid;
  grid-template-columns:repeat(2, minmax(0, 1fr));
  gap:10px;
  margin-top:12px;
}
.adPrices.one{grid-template-columns:1fr;}
.adPriceBox{
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  box-shadow: inset 0 16px 24px rgba(0,0,0,.35);
  padding:12px 12px 14px;
  text-align:center;
}
.adPriceBox .k{
  font-size:12px;
  font-weight:1000;
  letter-spacing:-.2px;
  color: rgba(248,255,252,.78);
  margin-bottom:6px;
}
.adPriceBox .v{
  font-size:40px;
  font-weight:1000;
  letter-spacing:-1.2px;
  line-height:1;
  color: var(--ledText);
  text-shadow: 0 0 16px rgba(0,255,180,.55), 0 2px 22px rgba(0,0,0,.85);
}
@media (max-width:420px){
  .adPriceBox .v{font-size:38px;}
}
.adPriceBox .v.neg{color:#ff5a5a;text-shadow: 0 0 16px rgba(255,90,90,.55), 0 2px 22px rgba(0,0,0,.85);}
.adPriceBox .v.zero{color:#42c7ff;text-shadow: 0 0 16px rgba(66,199,255,.55), 0 2px 22px rgba(0,0,0,.85);}

.adCTAs{
  display:flex;
  gap:10px;
  align-items:stretch;
}
.adBtn{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  color: rgba(248,255,252,.95);
  text-decoration:none;
  font-weight:1000;
  font-size:16px;
  padding:14px 12px;
  box-shadow: 0 14px 30px rgba(0,0,0,.35), inset 0 16px 24px rgba(0,0,0,.25);
}
.adBtn:active{transform: translateY(1px); filter:brightness(.98);}
.adBtn.kakao{
  background: rgba(254,229,0,.32);
  border-color: rgba(254,229,0,.55);
  color:#3b2f00;
}
.adBtn svg{width:20px;height:20px;stroke: currentColor;stroke-width:2.4;fill:none;stroke-linecap:round;stroke-linejoin:round;}

.adFoot{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding: 2px 2px 10px;
}
.adCheck{
  display:flex;
  align-items:center;
  gap:8px;
  color: rgba(248,255,252,.78);
  font-weight:1000;
  font-size:13px;
  user-select:none;
}
.adCheck input{width:18px;height:18px; accent-color: #22c55e;}
.adSmall{
  color: rgba(248,255,252,.62);
  font-weight:1000;
  font-size:12px;
}
</style>
</head>

<body>
<div class="wrap">

  <!-- 공지(업데이트 시간) + 관리자 숨김 새로고침 -->
  <div class="hero" aria-label="공지">
    <div class="heroMarquee2">
      <div class="marqueeLine" style="border-color:rgba(0,255,180,.22); box-shadow: inset 0 12px 20px rgba(0,0,0,.34), 0 0 0 2px rgba(0,255,180,.10), 0 0 18px rgba(0,255,180,.18);">
        <div class="marqueeInner">
          <div class="updateWrap">
            <div class="line1">시세표 업데이트 <span id="updateStamp">—</span></div>
            <div class="line2">새로고침 · 폰은 당겨서 · PC는 Ctrl+F5</div>
          </div>
        </div>
        <!-- 관리자 전용(기본 숨김). 공지바 5번 탭하면 나타남 -->
        <button class="heroRefreshBtn" id="refreshBtn" type="button" aria-label="새로고침">새로고침</button>
      </div>
    </div>
  </div>

  <!-- 서비스 탭 -->
  <div class="tabs" id="serviceTabs" aria-label="서비스 탭">
    <button class="tabBtn svc mvno" data-mode="MVNO">알뜰요금</button>
    <button class="tabBtn svc internet" data-mode="INTERNET">인터넷TV</button>
  </div>

  <!-- 휴대폰 탭 (SK/KT/LG만) -->
  <div class="tabs" id="phoneTabs" aria-label="휴대폰 탭">
    <button class="tabBtn sk active" data-tab="SK">SK</button>
    <button class="tabBtn kt" data-tab="KT">KT</button>
    <button class="tabBtn lg" data-tab="LG">LG</button>
  </div>

  <div class="panel">
    <div class="subTabs" id="mvnoTabs" aria-label="알뜰요금 망 서브탭">
      <button class="subTabBtn sk" data-mvno="SK">SK망</button>
      <button class="subTabBtn kt" data-mvno="KT">KT망</button>
      <button class="subTabBtn lg" data-mvno="LG">LG망</button>
    </div>

    <div class="subTabs" id="internetTabs" aria-label="인터넷TV 통신사 서브탭">
      <button class="subTabBtn sk" data-inet="SK">SK</button>
      <button class="subTabBtn kt" data-inet="KT">KT</button>
      <button class="subTabBtn lg" data-inet="LG">LG</button>
    </div>

    <div class="list" id="list"></div>
  </div>
</div>

<!-- A안: 오늘의 카드(광고) 팝업 -->
<div class="adBackdrop" id="adBackdrop" aria-hidden="true"></div>
<div class="adModal" id="adModal" aria-hidden="true" role="dialog" aria-label="오늘의 카드 팝업">
  <div class="adSheet" role="document">
    <div class="adTopBar">
      <div class="adTopRow">
        <div class="adTitleWrap">
          <div class="adTitle1">오늘의 초특가 · 성지급 특판</div>
          <div class="adTitle2">원하시면 카톡으로 “기종+용량”만 보내주세요</div>
        </div>
        <button class="adClose" id="adCloseBtn" type="button" aria-label="닫기">
          ✕
        </button>
      </div>
    </div>

    <div class="adBody">
      <div class="adHeroCard" id="adCard">
        <!-- JS로 채움 -->
      </div>

      <div class="adCTAs">
        <a class="adBtn kakao" id="adKakaoBtn" href="https://open.kakao.com/o/s729bI5h" target="_blank" rel="noopener" aria-label="카톡 문의">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M20 11c0 3.87-3.58 7-8 7a9.8 9.8 0 0 1-2.5-.33L4 20l1.66-4.15A6.3 6.3 0 0 1 4 11c0-3.87 3.58-7 8-7s8 3.13 8 7z"/>
            <path d="M9 11h.01"/>
            <path d="M12 11h.01"/>
            <path d="M15 11h.01"/>
          </svg>
          <span>카톡 문의</span>
        </a>
        <button class="adBtn" id="adOkBtn" type="button" aria-label="확인">
          <span>확인</span>
        </button>
      </div>

      <div class="adFoot">
        <label class="adCheck">
          <input type="checkbox" id="noShowToday" />
          <span>오늘 하루 다시 보지 않기</span>
        </label>
        <div class="adSmall">※ 조건/재고는 문의</div>
      </div>
    </div>
  </div>
</div>

<div class="bottomDock" role="navigation" aria-label="빠른 연락">
  <a class="dockBtn call" href="tel:042-821-2272" aria-label="전화">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.8 19.8 0 0 1 2.08 4.18 2 2 0 0 1 4.06 2h3a2 2 0 0 1 2 1.72c.12.9.32 1.77.6 2.6a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.48-1.12a2 2 0 0 1 2.11-.45c.83.28 1.7.48 2.6.6A2 2 0 0 1 22 16.92z"/>
    </svg>
    <span>전화</span>
  </a>

  <a class="dockBtn sms" href="sms:010-5839-1512" aria-label="문자">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/>
      <path d="M8 10h8"/>
      <path d="M8 14h5"/>
    </svg>
    <span>문자</span>
  </a>

  <a class="dockBtn kakao" href="https://open.kakao.com/o/s729bI5h" target="_blank" rel="noopener" aria-label="카톡">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M20 11c0 3.87-3.58 7-8 7a9.8 9.8 0 0 1-2.5-.33L4 20l1.66-4.15A6.3 6.3 0 0 1 4 11c0-3.87 3.58-7 8-7s8 3.13 8 7z"/>
      <path d="M9 11h.01"/>
      <path d="M12 11h.01"/>
      <path d="M15 11h.01"/>
    </svg>
    <span>카톡</span>
  </a>
</div>

<script>
const list = document.getElementById("list");
const phoneTabsEl = document.getElementById("phoneTabs");
const serviceTabsEl = document.getElementById("serviceTabs");
const mvnoTabsEl = document.getElementById("mvnoTabs");
const internetTabsEl = document.getElementById("internetTabs");

const CSV_VER = "2025-12-23";
const KAKAO_URL = "https://open.kakao.com/o/s729bI5h";

let mode = "PHONE";
let lastPhoneTab = "SK";
let mvnoNet = "LG";
let inetCarrier = "SK";

/* 업데이트 날짜/시간 자동 표시 (data.csv Last-Modified) */
async function setUpdateStamp(){
  const el = document.getElementById("updateStamp");
  if(!el) return;

  try{
    const res = await fetch(`data.csv?v=${encodeURIComponent(CSV_VER)}`, {
      method: "HEAD",
      cache: "no-store"
    });
    const lm = res.headers.get("last-modified");
    if(!lm) return;

    const d = new Date(lm);
    const parts = new Intl.DateTimeFormat("ko-KR", {
      timeZone: "Asia/Seoul",
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
      hour: "2-digit",
      minute: "2-digit",
      hour12: false
    }).formatToParts(d);

    const get = (t) => (parts.find(p => p.type === t)?.value || "");
    const stamp = `${get("year")}.${get("month")}.${get("day")} ${get("hour")}:${get("minute")}`;
    el.textContent = stamp;
  }catch(e){
    // 실패 시 아무 것도 하지 않음
  }
}

/* 관리자 전용 새로고침: 공지(상단 바) 5번 탭하면 버튼 토글 */
(function adminRefreshToggle(){
  const hero = document.querySelector(".hero");
  const btn = document.getElementById("refreshBtn");
  if(!hero || !btn) return;

  let taps = 0;
  let timer = null;

  const reset = () => {
    taps = 0;
    if(timer){ clearTimeout(timer); timer = null; }
  };

  hero.addEventListener("click", () => {
    taps += 1;

    // 2초 안에 5번 클릭하면 토글
    if(!timer){
      timer = setTimeout(() => reset(), 2000);
    }

    if(taps >= 5){
      const hidden = (getComputedStyle(btn).display === "none");
      btn.style.display = hidden ? "inline-flex" : "none";
      reset();
    }
  }, { passive:true });

  btn.addEventListener("click", (e) => {
    e.preventDefault();
    location.reload();
  });
})();

/* 부가서비스 */
const ADDON = {
  SK: [
    { t:"우주패스+플러스(무료)", d:"6개월 유지 / 미 가입시 +3" },
    { t:"마이스마트콜(3,500)", d:"3개월 유지 / 미 가입시 +2" },
    { t:"보험(모델별 상이)", d:"3개월 유지 / 미 가입시 +2" },
  ],
  KT: [
    { t:"필수팩(9,900)", d:"4개월 유지 / 미 가입시 +5" },
    { t:"보험(모델별 상이)", d:"4개월 유지 / 미 가입시 +3" },
    { t:"티빙 스탠다드+메가커피(13,500)", d:"4개월 유지 / 미 가입시 +5" }
  ],
  LG: [
    { t:"유플레이(15,400)", d:"95일 유지 / 미 가입시 +5" },
    { t:"V컬+음악(8,800)", d:"95일 유지 / 미 가입시 +5" },
    { t:"폰교체보험(모델별 상이)", d:"95일 유지 / 미 가입시 +5" },
  ],
};

/* 숫자 판단(색상용) */
const asNum = (x) => {
  const raw = String(x ?? "").replace(/\u2212/g, "-").replace(/,/g, "").trim();
  if (!raw) return null;
  const m = raw.match(/-?\d+(\.\d+)?/);
  if (!m) return null;
  let n = Number(m[0]);
  if (!Number.isFinite(n)) return null;
  if (raw.includes("만원") || raw.includes("만")) n = n * 10000;
  return n;
};
const showVal = (raw) => {
  const s = String(raw ?? "").replace(/\u2212/g, "-").trim();
  return s === "" ? "" : s;
};
const vClass = (n) => (n === null) ? "" : (n < 0 ? "neg" : (n === 0 ? "zero" : "pos"));

const fixedInfoLine = (c) => {
  if (c === "SK") return "SK 109요금 6개월 / 부가필수 문의";
  if (c === "KT") return "KT 110요금 6개월 / 부가필수 문의";
  return "LG 115요금 6개월 / 부가필수 문의";
};
const infoLineWithPlan = (c, x) => {
  const p = asNum(x[`${c}_요금제`]);
  return (p && p > 0) ? `${c} ${p}요금 6개월 / 부가필수 문의` : fixedInfoLine(c);
};

function clearList(){ list.innerHTML = ""; }
function showLoading(msg="불러오는 중…"){
  clearList();
  list.insertAdjacentHTML("beforeend", `<div class="loading">${msg}</div>`);
}
function setServiceActive(next){
  serviceTabsEl.querySelectorAll(".tabBtn").forEach(b => b.classList.remove("active"));
  if (!next) return;
  const el = serviceTabsEl.querySelector(`[data-mode="${next}"]`);
  if (el) el.classList.add("active");
}
function hideAllSubTabs(){
  mvnoTabsEl.classList.remove("show");
  internetTabsEl.classList.remove("show");
}
function activatePhoneTab(tab){
  phoneTabsEl.querySelectorAll(".tabBtn").forEach(b=>{
    b.classList.toggle("active", b.dataset.tab === tab);
  });
  lastPhoneTab = tab;
}
function showMvnoTabs(show){ show ? mvnoTabsEl.classList.add("show") : mvnoTabsEl.classList.remove("show"); }
function showInternetTabs(show){ show ? internetTabsEl.classList.add("show") : internetTabsEl.classList.remove("show"); }
function activateMvnoNet(net){
  mvnoNet = net;
  mvnoTabsEl.querySelectorAll(".subTabBtn").forEach(b=>{
    b.classList.toggle("active", b.dataset.mvno === net);
  });
}
function activateInetCarrier(c){
  inetCarrier = c;
  internetTabsEl.querySelectorAll(".subTabBtn").forEach(b=>{
    b.classList.toggle("active", b.dataset.inet === c);
  });
}

/* addon card */
function addAddonCard(carrier){
  const items = ADDON[carrier] || [];
  const pillClass = carrier === "SK" ? "sk" : (carrier === "KT" ? "kt" : "lg");

  const id = `addon_${carrier}`;
  const lis = items.map(x => `
    <li>
      ${x.t}
      <div class="sub">${x.d}</div>
    </li>
  `).join("");

  list.insertAdjacentHTML("beforeend", `
    <div class="card addonCard" id="${id}">
      <div class="addonHead" role="button" tabindex="0" aria-expanded="false">
        <div style="display:flex;align-items:center;gap:10px;min-width:0;">
          <span class="addonPill ${pillClass}">${carrier}</span>
          <span class="addonTitle">부가서비스 유지 조건</span>
        </div>
        <button class="addonBtn" type="button">펼치기</button>
      </div>
      <div class="addonBody">
        <ol class="addonList">${lis}</ol>
      </div>
    </div>
  `);

  const root = document.getElementById(id);
  const head = root.querySelector(".addonHead");
  const btn = root.querySelector(".addonBtn");
  const body = root.querySelector(".addonBody");

  const toggle = () => {
    const open = body.classList.toggle("show");
    head.setAttribute("aria-expanded", open ? "true" : "false");
    btn.textContent = open ? "접기" : "펼치기";
  };

  head.addEventListener("click", (e)=>{
    if (e.target === btn) return;
    toggle();
  });
  head.addEventListener("keydown", (e)=>{
    if (e.key === "Enter" || e.key === " ") { e.preventDefault(); toggle(); }
  });
  btn.addEventListener("click", (e)=>{ e.preventDefault(); toggle(); });
}

/* phone card */
function addPhoneCard({badgeText, badgeClass, model, move, change, infoText, discount}){
  const mv = (move ?? "");
  const ch = (change ?? "");
  const mvNum = asNum(mv);
  const chNum = asNum(ch);

  const hasMove = (mv !== "");
  const hasChange = (ch !== "");
  const rowClass = (hasMove && hasChange) ? "" : "one";

  list.insertAdjacentHTML("beforeend", `
    <div class="card">
      <div class="titleRow">
        <div class="model">${model}</div>
        <div class="badge ${badgeClass}">${badgeText}</div>
      </div>
      ${infoText ? `<p class="infoLine">${infoText}</p>` : ``}
      ${discount ? `<p class="discountLine">요금할인 25% 가능</p>` : ``}
      <div class="priceRow ${rowClass}">
        ${hasMove ? `
          <div class="pill">
            <div class="k">이동</div>
            <div class="v ${vClass(mvNum)}">${mv}</div>
          </div>` : ``}
        ${hasChange ? `
          <div class="pill">
            <div class="k">기변</div>
            <div class="v ${vClass(chNum)}">${ch}</div>
          </div>` : ``}
      </div>
    </div>
  `);
}

function addSimpleCard({badgeText, badgeClass, line1, line2, price1Label, price1, price2Label, price2}){
  list.insertAdjacentHTML("beforeend", `
    <div class="card">
      <div class="titleRow">
        <div class="model">${line1}</div>
        <div class="badge ${badgeClass}">${badgeText}</div>
      </div>
      ${line2 ? `<p class="planLine">${line2}</p>` : ``}
      <div class="moneyRow">
        <div class="label">${price1Label}</div>
        <div class="val">${price1}</div>
      </div>
      ${price2 ? `
        <div class="moneyRow" style="margin-top:6px;">
          <div class="label">${price2Label}</div>
          <div class="val2">${price2}</div>
        </div>` : ``}
    </div>
  `);
}
function addCompactNoticeCard(){
  list.insertAdjacentHTML("beforeend", `
    <div class="card noticeCard">
      <div class="row">
        <div class="twrap">
          <div class="t1">가입비·유심비 등 추가 요금 없음</div>
          <div class="t2">궁금하신 점은 카톡문의</div>
        </div>
        <a href="${KAKAO_URL}" target="_blank" rel="noopener">카톡 열기</a>
      </div>
    </div>
  `);
}
function addInternetNoticeCard(){
  list.insertAdjacentHTML("beforeend", `
    <div class="card noticeCard">
      <div class="row">
        <div class="twrap">
          <div class="t1"><strong>현금지원금</strong> 카톡문의</div>
          <div class="t2">궁금하신 점은 카톡문의</div>
        </div>
        <a href="${KAKAO_URL}" target="_blank" rel="noopener">카톡 열기</a>
      </div>
    </div>
  `);
}

/* internet data */
const INTERNET_TV = [
  {carrier:"SK", net:"100M", tv:"없음", monthly:"22,000", bundle:"17,600"},
  {carrier:"SK", net:"500M", tv:"없음", monthly:"33,000", bundle:"22,000"},
  {carrier:"SK", net:"1G",   tv:"없음", monthly:"38,500", bundle:"25,300"},
  {carrier:"SK", net:"100M", tv:"뉴이코노미", monthly:"34,100", bundle:"30,800"},
  {carrier:"SK", net:"100M", tv:"스탠다드",   monthly:"37,400", bundle:"34,100"},
  {carrier:"SK", net:"100M", tv:"ALL",        monthly:"40,700", bundle:"37,400"},
  {carrier:"SK", net:"500M", tv:"뉴이코노미", monthly:"41,800", bundle:"35,200"},
  {carrier:"SK", net:"500M", tv:"스탠다드",   monthly:"45,100", bundle:"38,500"},
  {carrier:"SK", net:"500M", tv:"ALL",        monthly:"48,400", bundle:"41,800"},
  {carrier:"SK", net:"1G",   tv:"뉴이코노미", monthly:"47,300", bundle:"38,500"},
  {carrier:"SK", net:"1G",   tv:"스탠다드",   monthly:"50,600", bundle:"41,800"},
  {carrier:"SK", net:"1G",   tv:"ALL",        monthly:"53,900", bundle:"45,100"},

  {carrier:"KT", net:"100M", tv:"없음", monthly:"22,000", bundle:"16,500"},
  {carrier:"KT", net:"500M", tv:"없음", monthly:"33,000", bundle:"22,000"},
  {carrier:"KT", net:"1G",   tv:"없음", monthly:"38,500", bundle:"27,500"},
  {carrier:"KT", net:"100M", tv:"베이직", monthly:"38,500", bundle:"33,000"},
  {carrier:"KT", net:"100M", tv:"모든G", monthly:"44,000", bundle:"40,700"},
  {carrier:"KT", net:"500M", tv:"베이직", monthly:"44,000", bundle:"38,500"},
  {carrier:"KT", net:"500M", tv:"모든G", monthly:"49,500", bundle:"44,000"},
  {carrier:"KT", net:"1G",   tv:"베이직", monthly:"49,500", bundle:"44,000"},
  {carrier:"KT", net:"1G",   tv:"모든G", monthly:"55,000", bundle:"49,500"},

  {carrier:"LG", net:"100M", tv:"없음", monthly:"22,000", bundle:"16,500"},
  {carrier:"LG", net:"500M", tv:"없음", monthly:"33,000", bundle:"23,100"},
  {carrier:"LG", net:"1G",   tv:"없음", monthly:"38,500", bundle:"25,300"},
  {carrier:"LG", net:"100M", tv:"실속형", monthly:"39,600", bundle:"34,100"},
  {carrier:"LG", net:"100M", tv:"프리미엄", monthly:"42,900", bundle:"37,400"},
  {carrier:"LG", net:"500M", tv:"실속형", monthly:"45,100", bundle:"35,200"},
  {carrier:"LG", net:"500M", tv:"프리미엄", monthly:"48,400", bundle:"38,500"},
  {carrier:"LG", net:"1G",   tv:"실속형", monthly:"50,600", bundle:"37,400"},
  {carrier:"LG", net:"1G",   tv:"프리미엄", monthly:"53,900", bundle:"40,700"},
];

/* mvno data */
const MVNO_PLANS = [
  {net:"LG", talk:"무제한", sms:"무제한", data:"1GB+1Mbps무제한", fee:"9,900"},
  {net:"LG", talk:"무제한", sms:"무제한", data:"7GB+1Mbps무제한", fee:"15,900"},
  {net:"LG", talk:"무제한", sms:"무제한", data:"10GB+1Mbps무제한", fee:"18,900"},
  {net:"LG", talk:"100분",  sms:"100건",  data:"15GB+3Mbps무제한", fee:"25,250"},
  {net:"LG", talk:"무제한", sms:"무제한", data:"11GB+일2GB+3Mbps무제한", fee:"32,990"},
  {net:"LG", talk:"무제한", sms:"무제한", data:"100GB+5Mbps무제한", fee:"38,200"},
  {net:"LG", talk:"50분",   sms:"50건",   data:"500MB", fee:"3,300"},
  {net:"LG", talk:"무제한", sms:"무제한", data:"1GB+1Mbps무제한", fee:"12,900"},
  {net:"LG", talk:"무제한", sms:"무제한", data:"5GB+1Mbps무제한", fee:"17,500"},
  {net:"LG", talk:"100분",  sms:"100건",  data:"15GB+망내1회선+3Mbps무제한", fee:"28,820"},

  {net:"KT", talk:"무제한", sms:"무제한", data:"2.5GB+400Kbps무제한", fee:"9,500"},
  {net:"KT", talk:"무제한", sms:"무제한", data:"7GB+1Mbps무제한", fee:"17,900"},
  {net:"KT", talk:"무제한", sms:"무제한", data:"10GB+1Mbps무제한", fee:"19,900"},
  {net:"KT", talk:"무제한", sms:"무제한", data:"15GB+1Mbps무제한", fee:"22,400"},
  {net:"KT", talk:"무제한", sms:"무제한", data:"11GB+일2GB+3Mbps무제한", fee:"34,000"},
  {net:"KT", talk:"무제한", sms:"무제한", data:"100GB+5Mbps무제한", fee:"39,900"},

  {net:"SK", talk:"2,000분", sms:"2,000건", data:"2GB", fee:"6,820"},
  {net:"SK", talk:"무제한",  sms:"무제한",  data:"1GB+1Mbps무제한", fee:"13,340"},
  {net:"SK", talk:"무제한",  sms:"무제한",  data:"7GB+1Mbps무제한", fee:"19,140"},
  {net:"SK", talk:"무제한",  sms:"무제한",  data:"10GB+1Mbps무제한", fee:"19,640"},
  {net:"SK", talk:"100분",   sms:"100건",   data:"15GB+3Mbps무제한", fee:"25,740"},
  {net:"SK", talk:"무제한",  sms:"무제한",  data:"11GB+일2GB+3Mbps무제한", fee:"36,140"},
];

/* CSV loader (간단 파서: 콤마/따옴표 포함 라인도 처리) */
function parseCSVLine(line){
  const out = [];
  let cur = "";
  let inQ = false;
  for(let i=0;i<line.length;i++){
    const ch = line[i];
    if(ch === '"'){
      if(inQ && line[i+1] === '"'){ cur += '"'; i++; }
      else inQ = !inQ;
      continue;
    }
    if(ch === "," && !inQ){
      out.push(cur);
      cur = "";
      continue;
    }
    cur += ch;
  }
  out.push(cur);
  return out;
}

async function fetchCSV(){
  const r = await fetch(`data.csv?v=${encodeURIComponent(CSV_VER)}`, { cache: "no-store" });
  if (!r.ok) throw new Error("data.csv 로드 실패");
  const t = await r.text();
  const lines = t.replace(/^\uFEFF/,"").trim().split(/\r?\n/);
  if (!lines.length) return [];
  const header = parseCSVLine(lines.shift()).map(s => String(s||"").trim());
  return lines.map(line => {
    const cols = parseCSVLine(line);
    const o = {};
    header.forEach((h,i)=> o[h] = String(cols[i] ?? "").trim());
    return o;
  });
}

/* SK/KT/LG “통신사 탭만”으로 표시 */
function buildCarrierSimple(items, carrier){
  const out = [];
  items.forEach(x=>{
    const model = String(x["기종"]||"").trim();
    if (!model) return;

    const mv = showVal(x[`${carrier}_이동`]);
    const ch = showVal(x[`${carrier}_기변`]);

    if (mv === "" && ch === "") return;

    out.push({
      model,
      mv,
      ch,
      infoText: infoLineWithPlan(carrier, x),
      discount: String(x["요금할인"]||"").trim().toUpperCase()==="O"
    });
  });

  out.sort((a,b)=> a.model.localeCompare(b.model, "ko"));
  return out;
}

/* render phone */
async function renderPhone(tab){
  mode = "PHONE";
  setServiceActive(null);
  hideAllSubTabs();
  showLoading("가격 불러오는 중…");

  let items = [];
  try{
    items = (await fetchCSV()).filter(x => String(x["기종"] ?? "").trim() !== "");
  }catch(e){
    clearList();
    list.insertAdjacentHTML("beforeend", `<p class="infoLine">CSV 파일을 읽지 못했습니다. (data.csv 파일명/위치 확인)</p>`);
    return;
  }

  clearList();

  if (!items.length){
    list.insertAdjacentHTML("beforeend", `<p class="infoLine">표시할 항목이 없습니다.</p>`);
    return;
  }

  if (!["SK","KT","LG"].includes(tab)) tab = "SK";

  addAddonCard(tab);

  const rows = buildCarrierSimple(items, tab);
  if (!rows.length){
    list.insertAdjacentHTML("beforeend", `<div class="loading">표시할 항목이 없습니다.</div>`);
    return;
  }

  const badgeClass = tab.toLowerCase();

  rows.forEach(it=>{
    addPhoneCard({
      badgeText: tab,
      badgeClass: badgeClass,
      model: it.model,
      move: it.mv,
      change: it.ch,
      infoText: it.infoText,
      discount: it.discount
    });
  });
}

/* internet */
function renderInternet(carrier = inetCarrier){
  mode = "INTERNET";
  setServiceActive("INTERNET");
  hideAllSubTabs();
  showInternetTabs(true);
  activateInetCarrier(carrier);
  clearList();

  addInternetNoticeCard();

  const filtered = INTERNET_TV.filter(x => x.carrier === carrier);
  const sorted = filtered.slice().sort((a,b)=> (asNum(a.monthly)||0) - (asNum(b.monthly)||0));

  sorted.forEach(x=>{
    const badgeClass = (x.carrier === "SK") ? "sk" : (x.carrier === "KT" ? "kt" : "lg");
    addSimpleCard({
      badgeText: x.carrier,
      badgeClass,
      line1: `[ ${x.carrier} ]`,
      line2: `${x.net} · TV${x.tv}`,
      price1Label: "월",
      price1: x.monthly,
      price2Label: "결합",
      price2: x.bundle
    });
  });
}

/* mvno */
function renderMVNO(net = mvnoNet){
  mode = "MVNO";
  setServiceActive("MVNO");
  hideAllSubTabs();
  showMvnoTabs(true);
  activateMvnoNet(net);
  clearList();

  addCompactNoticeCard();

  const filtered = MVNO_PLANS.filter(p => p.net === net);
  const sorted = filtered.slice().sort((a,b)=> (asNum(a.fee)||0) - (asNum(b.fee)||0));

  if (!sorted.length){
    list.insertAdjacentHTML("beforeend", `<div class="loading">등록된 ${net}망 요금제가 없습니다.</div>`);
    return;
  }

  sorted.forEach(p=>{
    const badgeClass = (p.net === "SK") ? "sk" : (p.net === "KT" ? "kt" : "lg");
    addSimpleCard({
      badgeText: p.net,
      badgeClass,
      line1: `${p.net}망 알뜰요금`,
      line2: `${p.data} / 통화 ${p.talk} / 문자 ${p.sms}`,
      price1Label: "월",
      price1: p.fee,
      price2Label: "",
      price2: ""
    });
  });
}

/* =========================
   오늘의 카드(광고 팝업)
   - CSV의 TODAY=1(또는 Y/O) 행 1개를 찾아 표시
   - 여러 개면 "가장 싼 조건" 행 1개 선택
   - 그 행 안에서 SK/KT/LG 중 "가장 싼 조건" 통신사 자동 선택
   - 세션 1회 + 오늘 하루 숨김(현재 카드 시그니처 기준)
   ========================= */
function isTodayRow(x){
  const v = String(x["TODAY"] ?? "").trim().toUpperCase();
  return v === "1" || v === "Y" || v === "O";
}
function pickBestTodayRow(items){
  const todayRows = items.filter(isTodayRow);
  if(!todayRows.length) return null;

  const rowScore = (row) => {
    const cands = [
      asNum(row["SK_이동"]), asNum(row["SK_기변"]),
      asNum(row["KT_이동"]), asNum(row["KT_기변"]),
      asNum(row["LG_이동"]), asNum(row["LG_기변"])
    ].filter(v => v !== null);

    if(!cands.length) return 9e15;
    return Math.min(...cands);
  };

  todayRows.sort((a,b)=> rowScore(a) - rowScore(b));
  return todayRows[0];
}

function makePickFromRow(row){
  if(!row) return null;
  const model = String(row["기종"]||"").trim();
  if(!model) return null;

  const candidates = [
    {carrier:"SK", move: showVal(row["SK_이동"]), change: showVal(row["SK_기변"])},
    {carrier:"KT", move: showVal(row["KT_이동"]), change: showVal(row["KT_기변"])},
    {carrier:"LG", move: showVal(row["LG_이동"]), change: showVal(row["LG_기변"])},
  ];

  const priced = candidates.map(c=>{
    const mvN = asNum(c.move);
    const chN = asNum(c.change);
    const best = [mvN, chN].filter(v=>v!==null);
    return { ...c, best: best.length ? Math.min(...best) : null };
  }).filter(c=> c.best !== null);

  if(!priced.length) return null;

  priced.sort((a,b)=> a.best - b.best);
  const bestCarrier = priced[0];

  const discount = String(row["요금할인"]||"").trim().toUpperCase()==="O";

  return {
    carrier: bestCarrier.carrier,
    model,
    move: bestCarrier.move,
    change: bestCarrier.change,
    infoText: infoLineWithPlan(bestCarrier.carrier, row),
    discount
  };
}

function safeHTML(s){
  return String(s ?? "")
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;");
}

function getTodayKey(){
  // Asia/Seoul 기준 날짜키 (YYYY-MM-DD)
  const parts = new Intl.DateTimeFormat("en-CA", {
    timeZone:"Asia/Seoul",
    year:"numeric", month:"2-digit", day:"2-digit"
  }).formatToParts(new Date());
  const get = (t) => (parts.find(p => p.type === t)?.value || "");
  const y = get("year"), m = get("month"), d = get("day");
  return `TODAY_POPUP_HIDE_${y}-${m}-${d}`;
}

function pickSignature(pick){
  // 오늘 숨김을 "현재 카드" 기준으로만 적용 (카드 바뀌면 다시 뜸)
  return [
    pick?.carrier||"",
    pick?.model||"",
    String(pick?.move||""),
    String(pick?.change||"")
  ].join("|");
}

async function openTodayPickPopupFromCSV(){
  const modal = document.getElementById("adModal");
  const backdrop = document.getElementById("adBackdrop");
  const closeBtn = document.getElementById("adCloseBtn");
  const okBtn = document.getElementById("adOkBtn");
  const noShowToday = document.getElementById("noShowToday");
  const card = document.getElementById("adCard");
  const kakaoBtn = document.getElementById("adKakaoBtn");
  if(!modal || !backdrop || !card || !kakaoBtn) return;

  // 카카오 링크 동기화
  kakaoBtn.href = KAKAO_URL;

  let items = [];
  try{
    items = (await fetchCSV()).filter(x => String(x["기종"] ?? "").trim() !== "");
  }catch(e){
    return;
  }

  const row = pickBestTodayRow(items);
  const pick = makePickFromRow(row);
  if(!pick) return;

  const sig = pickSignature(pick);

  // 세션 1회 (동일 세션에서 여러 번 안 뜸)
  try{
    if(sessionStorage.getItem("TODAY_POPUP_SEEN_SESSION") === sig) return;
  }catch(e){}

  // 오늘 하루 다시보지 않기 (현재 카드 sig와 같으면 숨김)
  try{
    const hiddenSig = localStorage.getItem(getTodayKey()) || "";
    if(hiddenSig === sig) return;
  }catch(e){}

  const carrierClass = (pick.carrier === "SK") ? "sk" : (pick.carrier === "KT" ? "kt" : "lg");
  const mv = String(pick.move ?? "");
  const ch = String(pick.change ?? "");
  const hasMove = mv !== "";
  const hasChange = ch !== "";
  const rowClass = (hasMove && hasChange) ? "" : "one";
  const mvNum = asNum(mv);
  const chNum = asNum(ch);

  card.innerHTML = `
    <div class="adBadgeRow">
      <div class="adTag">오늘의 카드</div>
      <div class="adCarrierPill ${carrierClass}">${safeHTML(pick.carrier)}</div>
    </div>

    <div class="adModel">${safeHTML(pick.model)}</div>
    ${pick.infoText ? `<div class="adInfo">${safeHTML(pick.infoText)}</div>` : ``}
    ${pick.discount ? `<div class="adDisc">요금할인 25% 가능</div>` : ``}

    <div class="adPrices ${rowClass}">
      ${hasMove ? `
        <div class="adPriceBox">
          <div class="k">이동</div>
          <div class="v ${vClass(mvNum)}">${safeHTML(mv)}</div>
        </div>` : ``}
      ${hasChange ? `
        <div class="adPriceBox">
          <div class="k">기변</div>
          <div class="v ${vClass(chNum)}">${safeHTML(ch)}</div>
        </div>` : ``}
    </div>
  `;

  const open = () => {
    backdrop.classList.add("show");
    modal.classList.add("show");
    backdrop.setAttribute("aria-hidden","false");
    modal.setAttribute("aria-hidden","false");
    document.body.style.overflow = "hidden";
    try{ sessionStorage.setItem("TODAY_POPUP_SEEN_SESSION", sig); }catch(e){}
  };

  const close = () => {
    try{
      if(noShowToday && noShowToday.checked){
        localStorage.setItem(getTodayKey(), sig);
      }
    }catch(e){}
    backdrop.classList.remove("show");
    modal.classList.remove("show");
    backdrop.setAttribute("aria-hidden","true");
    modal.setAttribute("aria-hidden","true");
    document.body.style.overflow = "";
  };

  // 이벤트 중복 방지: 한 번만 바인딩
  if(!modal.dataset.bound){
    backdrop.addEventListener("click", close);
    closeBtn.addEventListener("click", close);
    okBtn.addEventListener("click", close);
    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape" && modal.classList.contains("show")) close();
    });
    modal.dataset.bound = "1";
  }

  setTimeout(open, 260);
}

/* events */
phoneTabsEl.querySelectorAll(".tabBtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const tab = btn.dataset.tab;
    activatePhoneTab(tab);
    serviceTabsEl.querySelectorAll(".tabBtn").forEach(b => b.classList.remove("active"));
    renderPhone(tab);
  });
});
serviceTabsEl.querySelectorAll(".tabBtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const next = btn.dataset.mode;

    if (mode === next){
      serviceTabsEl.querySelectorAll(".tabBtn").forEach(b => b.classList.remove("active"));
      activatePhoneTab(lastPhoneTab);
      renderPhone(lastPhoneTab);
      return;
    }

    if (next === "MVNO") renderMVNO(mvnoNet);
    if (next === "INTERNET") renderInternet(inetCarrier);
  });
});
mvnoTabsEl.querySelectorAll(".subTabBtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const net = btn.dataset.mvno;
    renderMVNO(net);
  });
});
internetTabsEl.querySelectorAll(".subTabBtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const c = btn.dataset.inet;
    renderInternet(c);
  });
});

/* init */
setUpdateStamp();
activatePhoneTab("SK");
renderPhone("SK");

/* A안 팝업: TODAY=1 있으면 자동 노출 */
openTodayPickPopupFromCSV();

/* (옵션) SW 자동 새로고침 준비: sw.js 올리면 바로 활성화됨 */
(async function(){
  if(!('serviceWorker' in navigator)) return;
  try{
    const reg = await navigator.serviceWorker.register('./sw.js');

    reg.addEventListener('updatefound', () => {
      const sw = reg.installing;
      if(!sw) return;
      sw.addEventListener('statechange', () => {
        if(sw.state === 'installed' && navigator.serviceWorker.controller){
          sw.postMessage({ type: 'SKIP_WAITING' });
        }
      });
    });

    let reloaded = false;
    navigator.serviceWorker.addEventListener('controllerchange', () => {
      if(reloaded) return;
      reloaded = true;
      location.reload();
    });
  }catch(e){}
})();
</script>
</body>
</html>
