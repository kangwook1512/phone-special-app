<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>복지관 2층 휴대폰 특판</title>
  <meta name="description" content="SK·KT·LG 성지 시세표(이동/기변) + 인터넷/알뜰 + 0원/저가 특가 안내" />
  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --ink:#0b1220;
      --muted:#667085;
      --line:#e6eaf2;
      --chip:#f1f5ff;
      --chipOn:#0b5cff;
      --chipOnInk:#ffffff;
      --shadow: 0 8px 22px rgba(16,24,40,.08);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      background: var(--bg);
      color: var(--ink);
    }

    /* 1) 상단 1줄 (작고 얇게) */
    .topline{
      position: sticky;
      top:0;
      z-index: 50;
      background: rgba(245,247,251,.92);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .topline-inner{
      max-width: 1100px;
      margin: 0 auto;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      gap:10px;
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
      font-weight: 700;
      font-size: 14px;
    }
    .badge{
      padding: 6px 10px;
      border:1px solid var(--line);
      border-radius: 999px;
      background:#fff;
      font-weight: 800;
      font-size: 13px;
      flex:0 0 auto;
    }
    .toptext{
      color: var(--muted);
      font-weight: 700;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* 전체 레이아웃 */
    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 10px 12px 80px;
    }

    /* 2) 탭 (2열, 답답하지 않게 낮은 높이) */
    .hub{
      margin-top: 10px;
      background: transparent;
    }
    .hub-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .hub-btn{
      border:1px solid var(--line);
      background:#fff;
      border-radius: 14px;
      padding: 10px 10px;
      font-weight: 900;
      font-size: 14px;
      line-height: 1;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      user-select:none;
      cursor:pointer;
      min-height: 42px; /* 답답하지 않게 낮게 */
      box-shadow: 0 3px 10px rgba(16,24,40,.04);
    }
    .hub-btn small{
      font-weight: 800;
      color: var(--muted);
      font-size: 12px;
    }
    .hub-btn.on{
      background: var(--chipOn);
      border-color: var(--chipOn);
      color: var(--chipOnInk);
      box-shadow: 0 10px 22px rgba(11,92,255,.18);
    }
    .hub-btn.on small{ color: rgba(255,255,255,.92); }

    /* 섹션 타이틀 */
    .section{
      margin-top: 14px;
    }
    .section-head{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      padding: 8px 2px;
    }
    .section-head h2{
      margin:0;
      font-size: 16px;
      letter-spacing: -.2px;
    }
    .section-head .hint{
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
    }

    /* 3) 카드(주인공) - 2열 */
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px 12px;
      min-height: 118px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .card-top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 8px;
    }
    .carrier{
      font-weight: 1000;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .2px;
    }
    .model{
      margin-top: 2px;
      font-size: 14px;
      font-weight: 1000;
      letter-spacing: -.2px;
      line-height: 1.15;
    }

    /* 이동/기변 2값 */
    .prices{
      margin-top: 10px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      align-items:end;
    }
    .pbox{
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 8px 8px;
      background: #fbfcff;
      min-height: 54px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      text-align:center;
    }
    .plabel{
      font-size: 11px;
      font-weight: 900;
      color: var(--muted);
      margin-bottom: 2px;
    }
    .pval{
      font-size: 22px;
      font-weight: 1100;
      letter-spacing: -.6px;
      line-height: 1.05;
    }
    .pval .unit{
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
      margin-left: 2px;
    }

    .tags{
      margin-top: 10px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .chip{
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: var(--chip);
      font-size: 12px;
      font-weight: 900;
      color:#1b3cff;
    }

    /* 특가 하단 안내 (휴대폰 시세 섹션 아래에만) */
    .finebar{
      margin-top: 10px;
      border:1px dashed #cfd6ea;
      background: rgba(255,255,255,.7);
      color: var(--muted);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 12px;
      font-weight: 800;
    }

    /* 0원/저가 전용 카드(완전 다른 형태) */
    .deal{
      background:#fff;
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px;
      min-height: 110px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .deal .big{
      font-size: 18px;
      font-weight: 1100;
      letter-spacing: -.4px;
    }
    .deal .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-top:6px;
    }
    .deal .meta{
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
      line-height:1.2;
    }
    .deal .price{
      font-size: 22px;
      font-weight: 1100;
      letter-spacing: -.6px;
    }

    /* 서비스 타일(얇게) */
    .service-tile{
      margin-top: 14px;
      border:1px solid var(--line);
      background:#fff;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 1000;
      box-shadow: 0 5px 16px rgba(16,24,40,.06);
    }
    .service-tile small{
      display:block;
      margin-top: 3px;
      font-weight: 900;
      color: var(--muted);
    }

    /* 하단 연락(단순) */
    .contact{
      margin-top: 18px;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }
    .contact a{
      text-decoration:none;
      color: var(--ink);
      background:#fff;
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 12px 10px;
      font-weight: 1100;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 5px 16px rgba(16,24,40,.06);
    }

    /* 빈 상태 */
    .empty{
      border:1px dashed #cfd6ea;
      background: rgba(255,255,255,.6);
      border-radius: 14px;
      padding: 12px;
      color: var(--muted);
      font-weight: 900;
      font-size: 13px;
    }

    @media (max-width: 380px){
      .pval{ font-size: 20px; }
      .hub-btn{ font-size: 13px; }
    }
  </style>
</head>

<body>
  <!-- 1) 상단 1줄 -->
  <div class="topline">
    <div class="topline-inner">
      <span class="badge">복지관 2층</span>
      <span class="toptext">휴대폰 성지 시세표 · SK/KT/LG · 인터넷/알뜰 · 0원/저가 특가</span>
    </div>
  </div>

  <div class="wrap">
    <!-- 2) 2열 허브 탭 -->
    <div class="hub" id="hub">
      <div class="hub-grid" id="hubGrid"></div>
    </div>

    <!-- 섹션: 리스트 -->
    <div class="section">
      <div class="section-head">
        <h2 id="sectionTitle">휴대폰 시세</h2>
        <div class="hint" id="sectionHint">탭을 눌러 빠르게 보기</div>
      </div>

      <div id="content"></div>

      <!-- 특가 하단 안내: 휴대폰 시세 탭에서만 노출 -->
      <div class="finebar" id="finebar" style="display:none;">
        요금제 및 부가서비스는 별도 문의
      </div>

      <!-- 서비스 타일: 1회 노출 -->
      <div class="service-tile" id="serviceTile" style="display:none;">
        액정필름 무료교체
        <small>(카톡 문의 후 방문)</small>
      </div>

      <!-- 하단 연락: 단순 -->
      <div class="contact">
        <a href="tel:042-821-2272">전화</a>
        <a href="sms:010-5839-1512">문자</a>
        <a href="https://open.kakao.com/o/s729bl5h" target="_blank" rel="noopener">카톡</a>
      </div>
    </div>
  </div>

  <script>
    // ====== 설정: 탭 정의 (2열) ======
    // type:
    //  - phone: 휴대폰 시세(이동/기변 2값 카드)
    //  - net: 인터넷/알뜰 등 (필요하면 phone 카드형으로도 가능)
    //  - deals: 0원/저가(완전 다른 카드형)
    const TABS = [
      { key: "SK",   label: "SK",   sub:"시세",   group:"phone", carrier:"SK" },
      { key: "KT",   label: "KT",   sub:"시세",   group:"phone", carrier:"KT" },
      { key: "LG",   label: "LG",   sub:"시세",   group:"phone", carrier:"LG" },
      { key: "INTERNET", label:"인터넷", sub:"혜택", group:"net" },
      { key: "MVNO", label:"알뜰",   sub:"요금", group:"net" },
      { key: "DEALS", label:"0원/저가", sub:"유동", group:"deals" },
    ];

    // ====== 데이터 로드(CSV) ======
    // data.csv 컬럼(헤더):
    // group,carrier,model,storage,move,keep,plan,price,tag,order
    // group: phone | net | deals
    // price: deals 전용(실구매가 등)
    const DATA_URL = "data.csv";
    let state = {
      tabKey: "SK",
      rows: []
    };

    const $hubGrid = document.getElementById("hubGrid");
    const $content = document.getElementById("content");
    const $title = document.getElementById("sectionTitle");
    const $hint = document.getElementById("sectionHint");
    const $finebar = document.getElementById("finebar");
    const $serviceTile = document.getElementById("serviceTile");

    function setActiveTab(key){
      state.tabKey = key;
      renderHub();
      renderContent(); // 현재 위치 유지 (scrollTo 하지 않음)
    }

    function renderHub(){
      $hubGrid.innerHTML = "";
      for (const t of TABS){
        const btn = document.createElement("button");
        btn.className = "hub-btn" + (t.key === state.tabKey ? " on" : "");
        btn.type = "button";
        btn.innerHTML = `${t.label} <small>${t.sub}</small>`;
        btn.addEventListener("click", () => setActiveTab(t.key));
        $hubGrid.appendChild(btn);
      }
    }

    function parseCSV(text){
      const lines = text.replace(/\r/g,"").split("\n").filter(l => l.trim().length>0);
      if(lines.length === 0) return [];
      const headers = splitCSVLine(lines[0]).map(h => h.trim());
      const out = [];
      for(let i=1;i<lines.length;i++){
        const cols = splitCSVLine(lines[i]);
        const obj = {};
        headers.forEach((h, idx) => obj[h] = (cols[idx] ?? "").trim());
        // 숫자 정렬용 order
        obj._order = Number(obj.order || 9999);
        out.push(obj);
      }
      return out;
    }

    // CSV 한 줄 split(따옴표 처리)
    function splitCSVLine(line){
      const result = [];
      let cur = "";
      let inQ = false;
      for(let i=0;i<line.length;i++){
        const ch = line[i];
        if(ch === '"'){
          if(inQ && line[i+1] === '"'){ cur += '"'; i++; }
          else inQ = !inQ;
        } else if(ch === "," && !inQ){
          result.push(cur);
          cur = "";
        } else {
          cur += ch;
        }
      }
      result.push(cur);
      return result;
    }

    function fmtPrice(v){
      const s = (v ?? "").toString().trim();
      if(!s) return "—";
      return s;
    }

    function renderPhoneCards(rows){
      // 모델/가격/통신사조건만 (요금제/부가 없음)
      // card 1개 안에 이동/기변 2값
      const grid = document.createElement("div");
      grid.className = "grid";

      if(rows.length === 0){
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.textContent = "해당 조건의 특가가 현재 없습니다.";
        return empty;
      }

      for(const r of rows){
        const card = document.createElement("div");
        card.className = "card";

        const top = document.createElement("div");
        top.className = "card-top";

        const left = document.createElement("div");
        const carrier = document.createElement("div");
        carrier.className = "carrier";
        carrier.textContent = (r.carrier || "").toUpperCase();

        const model = document.createElement("div");
        model.className = "model";
        const storage = r.storage ? ` ${r.storage}` : "";
        model.textContent = `${r.model || ""}${storage}`.trim();

        left.appendChild(carrier);
        left.appendChild(model);

        top.appendChild(left);
        card.appendChild(top);

        const prices = document.createElement("div");
        prices.className = "prices";

        const mv = document.createElement("div");
        mv.className = "pbox";
        mv.innerHTML = `<div class="plabel">이동</div><div class="pval">${fmtPrice(r.move)}<span class="unit">만</span></div>`;

        const kv = document.createElement("div");
        kv.className = "pbox";
        kv.innerHTML = `<div class="plabel">기변</div><div class="pval">${fmtPrice(r.keep)}<span class="unit">만</span></div>`;

        // 값이 이미 "0원", "-13" 같이 문자일 수 있으니 unit(만) 싫으면 data에서 단위 포함해도 됨.
        // 단위가 싫으면 아래 2줄을 주석 처리하고 data에 "0원"처럼 넣어.
        if(String(r.move||"").includes("원") || String(r.move||"").includes("만원")) mv.querySelector(".unit").textContent = "";
        if(String(r.keep||"").includes("원") || String(r.keep||"").includes("만원")) kv.querySelector(".unit").textContent = "";

        prices.appendChild(mv);
        prices.appendChild(kv);
        card.appendChild(prices);

        // 태그(선택)
        const chips = [];
        if(r.tag){
          r.tag.split("|").map(x=>x.trim()).filter(Boolean).forEach(t => chips.push(t));
        }
        if(chips.length){
          const tags = document.createElement("div");
          tags.className = "tags";
          chips.slice(0,3).forEach(t=>{
            const c = document.createElement("span");
            c.className = "chip";
            c.textContent = t;
            tags.appendChild(c);
          });
          card.appendChild(tags);
        }

        grid.appendChild(card);
      }
      return grid;
    }

    function renderDeals(rows){
      if(rows.length === 0){
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.textContent = "저가/0원 특가는 수시로 변동됩니다.";
        return empty;
      }

      const grid = document.createElement("div");
      grid.className = "grid";
      for(const r of rows){
        const d = document.createElement("div");
        d.className = "deal";

        const title = document.createElement("div");
        const storage = r.storage ? ` ${r.storage}` : "";
        title.className = "big";
        title.textContent = `${r.model || ""}${storage}`.trim();

        const meta = document.createElement("div");
        meta.className = "meta";
        // 예: LG 이동 / 청소년 33요금
        const line1 = `${(r.carrier||"").toUpperCase()} / ${(r.keep||r.move||"이동").trim() || "이동"}`; // deals에선 move/keep 컬럼을 "이동/신규/기변" 상태로 써도 됨
        const line2 = (r.plan || "").trim();
        meta.innerHTML = `${line1}<br>${line2}`.trim();

        const row = document.createElement("div");
        row.className = "row";

        const price = document.createElement("div");
        price.className = "price";
        price.textContent = (r.price || "").trim() || "—";

        row.appendChild(meta);
        row.appendChild(price);

        d.appendChild(title);
        d.appendChild(row);

        grid.appendChild(d);
      }
      return grid;
    }

    function renderNet(rows){
      // 인터넷/알뜰: 카드만(요금제/부가 강조 X)
      // 일단 phone 카드형으로 보여주되, move/keep 대신 price 하나만 쓰고 싶으면 data 설계를 바꾸면 됨.
      if(rows.length === 0){
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.textContent = "해당 정보가 아직 없습니다.";
        return empty;
      }
      // 간단히 phone 카드형을 재사용: move=혜택, keep=조건 등으로 사용 가능
      return renderPhoneCards(rows);
    }

    function renderContent(){
      $content.innerHTML = "";
      const tab = TABS.find(t => t.key === state.tabKey);

      // 섹션 헤더 텍스트
      if(tab.group === "phone"){
        $title.textContent = `${tab.carrier} 휴대폰 시세`;
        $hint.textContent = "같은 모델 이동/기변 한눈에 비교";
      } else if(tab.group === "net"){
        $title.textContent = tab.key === "INTERNET" ? "인터넷/TV" : "알뜰 요금";
        $hint.textContent = "카드로 빠르게 확인";
      } else {
        $title.textContent = "0원/저가 특가";
        $hint.textContent = "유동 특가 · 조건/요금제 상이";
      }

      // 데이터 필터
      let rows = state.rows.slice().sort((a,b)=>a._order - b._order);

      if(tab.group === "phone"){
        rows = rows.filter(r => r.group === "phone" && (r.carrier||"").toUpperCase() === tab.carrier);
        $finebar.style.display = "block";              // 휴대폰 시세에서만
        $serviceTile.style.display = "block";          // 서비스 타일 1회 노출(원하면 phone에서만)
        $content.appendChild(renderPhoneCards(rows));
      }
      else if(tab.group === "net"){
        rows = rows.filter(r => r.group === "net" && (tab.key === "INTERNET" ? r.tag?.includes("인터넷") || true : r.tag?.includes("알뜰") || true));
        // net은 별도 구분이 필요하면 data에 netType 컬럼 추가해서 필터하면 됨.
        $finebar.style.display = "none";
        $serviceTile.style.display = "block";          // 서비스 타일은 탭 공통으로도 OK
        $content.appendChild(renderNet(rows));
      }
      else { // deals
        rows = rows.filter(r => r.group === "deals");
        $finebar.style.display = "none";
        $serviceTile.style.display = "block";
        $content.appendChild(renderDeals(rows));
      }
    }

    async function init(){
      renderHub();
      try{
        const res = await fetch(DATA_URL, { cache: "no-store" });
        const text = await res.text();
        state.rows = parseCSV(text);
      }catch(e){
        state.rows = [];
      }
      renderContent();
    }

    init();
  </script>
</body>
</html>
