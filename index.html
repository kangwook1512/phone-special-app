<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ë³µì§€ê´€2ì¸µë§¤ì¥</title>
  <style>
    :root{
      --bg:#f5f6f8; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb;
      --sk:#2563eb; --kt:#111827; --lg:#16a34a; --hot:#f97316; --low:#7c3aed;
      --call:#22c55e; --sms:#38bdf8; --kakao:#fee500;
    }
    *{box-sizing:border-box;} html,body{margin:0;padding:0;}
    body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",system-ui,sans-serif;background:var(--bg);color:var(--ink);}
    .wrap{max-width:760px;margin:0 auto;padding:14px 14px 164px;}
    .hero{background:#ffe866;border:2px solid #ffeb3b;border-radius:14px;padding:14px;text-align:center;font-weight:900;box-shadow:0 6px 16px rgba(0,0,0,.08);}
    .hero .sub{margin-top:6px;font-weight:800;font-size:14px;} .hero .sub b{text-decoration:underline;}
    .tabs.nice{display:flex;gap:8px;margin-top:14px;}
    .tabs.nice .tabBtn{flex:1;padding:12px 0;border-radius:999px;border:1px solid var(--line);background:#fff;font-weight:1000;font-size:14px;cursor:pointer;transition:all .15s ease;}
    .tabs.nice .tabBtn.active{color:#fff;border-color:transparent;}
    .tabs.nice .tabBtn.sk.active{background:var(--sk);} .tabs.nice .tabBtn.kt.active{background:var(--kt);}
    .tabs.nice .tabBtn.lg.active{background:var(--lg);} .tabs.nice .tabBtn.hot.active{background:var(--hot);}
    .tabs.nice .tabBtn.low.active{background:var(--low);}
    .panel{margin-top:14px;background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px;}
    .emptyTitle{font-weight:1000;font-size:16px;margin-bottom:6px;}
    .emptyDesc{color:var(--muted);font-weight:800;font-size:13px;white-space:pre-line;}
    .list{display:flex;flex-direction:column;gap:10px;}
    .card{border:1px solid var(--line);border-radius:14px;padding:12px;box-shadow:0 2px 10px rgba(0,0,0,.05);background:#fff;}
    .titleRow{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px;}
    .model{font-weight:1000;font-size:16px;letter-spacing:-.2px;}
    .badge{font-weight:1000;font-size:12px;padding:6px 10px;border-radius:999px;color:#fff;white-space:nowrap;}
    .badge.sk{background:var(--sk);} .badge.kt{background:var(--kt);} .badge.lg{background:var(--lg);}
    .badge.hot{background:var(--hot);} .badge.low{background:var(--low);}
    .infoLine{margin:0 0 10px;color:var(--muted);font-weight:1000;font-size:12px;}
    .priceRow{display:flex;gap:10px;}
    .pill{flex:1;border:1px solid var(--line);border-radius:12px;padding:10px 10px;text-align:center;background:#fafafa;}
    .pill .k{color:var(--muted);font-weight:1000;font-size:12px;margin-bottom:4px;}
    .pill .v{font-weight:1000;font-size:20px;letter-spacing:-.4px;}
    .neg{color:#dc2626;} .zero{color:#0ea5e9;} .pos{color:#0f172a;}
    .fixedNotice{position:fixed;bottom:60px;left:0;right:0;background:#fff;border-top:1px solid var(--line);text-align:center;font-weight:1000;padding:10px 12px;z-index:998;line-height:1.25;}
    .bottomBar{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--line);display:flex;height:60px;z-index:999;}
    .action{flex:1;display:flex;align-items:center;justify-content:center;font-weight:1000;text-decoration:none;color:#0b1220;font-size:16px;}
    .action.call{background:var(--call);color:#fff;} .action.sms{background:var(--sms);color:#05202b;} .action.kakao{background:var(--kakao);color:#3b2f00;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      ì¸í„°ë„·TVÂ·ì•Œëœ°ìš”ê¸ˆì€ ì¹´í†¡ë¬¸ì˜
      <div class="sub">ğŸª™ ì¸í„°ë„·TV : <b>í˜„ê¸ˆ ìµœëŒ€ ì§€ì›</b></div>
      <div class="sub">ğŸ”¥ ì•Œëœ°ìš”ê¸ˆ : <b>ìµœì €ìš”ê¸ˆ 3,300ì›~</b></div>
    </div>

    <div class="tabs nice">
      <button class="tabBtn sk active" data-tab="SK">SK</button>
      <button class="tabBtn kt" data-tab="KT">KT</button>
      <button class="tabBtn lg" data-tab="LG">LG</button>
      <button class="tabBtn hot" data-tab="HOT">í•«ë”œ</button>
      <button class="tabBtn low" data-tab="LOW">ì €ê°€</button>
    </div>

    <div class="panel">
      <div id="empty" style="display:none;">
        <div class="emptyTitle">í‘œì‹œí•  í•­ëª© ì—†ìŒ</div>
        <div class="emptyDesc" id="emptyDesc"></div>
      </div>
      <div class="list" id="list"></div>
    </div>
  </div>

  <div class="fixedNotice">ì•¡ì •í•„ë¦„ ë¬´ë£Œêµì²´<br>ì¹´í†¡ ì£¼ë¬¸ í›„ ë³µì§€ê´€2ì¸µ ë§¤ì¥ ë°©ë¬¸</div>
  <div class="bottomBar">
    <a class="action call" href="tel:042-821-2272">ì „í™”</a>
    <a class="action sms" href="sms:010-5839-1512">ë¬¸ì</a>
    <a class="action kakao" href="https://open.kakao.com/o/s729bI5h" target="_blank" rel="noopener">ì¹´í†¡</a>
  </div>

<script>
  function parseCSV(text){
    text = text.replace(/^\uFEFF/, "");
    const rows = [];
    let row = [], cur = "", inQuotes = false;
    for (let i=0; i<text.length; i++){
      const ch = text[i], next = text[i+1];
      if (inQuotes){
        if (ch === '"' && next === '"'){ cur += '"'; i++; }
        else if (ch === '"'){ inQuotes = false; }
        else cur += ch;
      } else {
        if (ch === '"') inQuotes = true;
        else if (ch === ','){ row.push(cur); cur = ""; }
        else if (ch === '\n'){ row.push(cur); if (row.some(v=>String(v).trim()!=="")) rows.push(row); row=[]; cur=""; }
        else if (ch === '\r'){}
        else cur += ch;
      }
    }
    row.push(cur);
    if (row.some(v=>String(v).trim()!=="")) rows.push(row);
    return rows;
  }

  async function fetchCSV(path){
    const url = `${path}?v=${Date.now()}`;
    const res = await fetch(url, { cache: "no-store" });
    if (!res.ok) throw new Error(`CSV HTTP ${res.status} (ê²½ë¡œ/íŒŒì¼ëª… í™•ì¸)`);
    const text = await res.text();
    const rows = parseCSV(text);
    if (!rows.length) return { items: [], header: [] };
    const header = rows.shift().map(h => String(h).trim());
    const items = rows.map(r => {
      const o = {};
      header.forEach((h,i)=> o[h] = String(r[i] ?? "").trim());
      return o;
    });
    return { items, header };
  }

  function asNum(x){
    const s = String(x ?? "").replace(/[âˆ’-â€“â€”â€’ï¹£ï¼]/g,"-").replace(/,/g,"").trim();
    if (s==="") return null;
    const n = Number(s);
    return Number.isFinite(n) ? n : null;
  }
  function vClass(n){ if (n===null) return ""; if (n<0) return "neg"; if (n===0) return "zero"; return "pos"; }
  function escapeHtml(s){ return String(s ?? "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;"); }

  function setEmpty(show, msg){
    const empty = document.getElementById("empty");
    const desc = document.getElementById("emptyDesc");
    empty.style.display = show ? "block" : "none";
    desc.textContent = msg || "";
  }
  function clearList(){ document.getElementById("list").innerHTML = ""; }

  // âœ… í—¤ë” ìë™ ë§¤í•‘ (ê¸°ì¢…/ëª¨ë¸ëª… ì–´ë–¤ ì´ë¦„ì´ ì™€ë„ ëŒ€ì‘)
  function findKey(header, candidates){
    const norm = s => String(s).replace(/\s+/g,"").toLowerCase();
    const hnorm = header.map(h=>({raw:h, n:norm(h)}));
    for (const c of candidates){
      const cn = norm(c);
      const hit = hnorm.find(x=>x.n===cn);
      if (hit) return hit.raw;
    }
    return null;
  }
  function mkCarrierKeys(header, carrier){
    const base = carrier.toLowerCase();
    const move = findKey(header, [`${carrier}_ì´ë™`, `${carrier}ì´ë™`, `${base}_ì´ë™`, `${base}ì´ë™`, `${carrier}_m`, `${carrier}move`]);
    const chg  = findKey(header, [`${carrier}_ê¸°ë³€`, `${carrier}ê¸°ë³€`, `${base}_ê¸°ë³€`, `${base}ê¸°ë³€`, `${carrier}_c`, `${carrier}change`]);
    const plan = findKey(header, [`${carrier}_ìš”ê¸ˆì œ`, `${carrier}ìš”ê¸ˆì œ`, `${base}_ìš”ê¸ˆì œ`, `${base}ìš”ê¸ˆì œ`, `${carrier}_plan`]);
    return { move, chg, plan };
  }

  function infoLine(carrier, row, planKey){
    const plan = planKey ? asNum(row[planKey]) : null;
    const def = (carrier==="SK")?109:(carrier==="KT")?110:115;
    const use = (plan!==null && plan>0) ? plan : def;
    return `${carrier} ${use}ìš”ê¸ˆ 6ê°œì›” / ë¶€ê°€í•„ìˆ˜ ë¬¸ì˜`;
  }

  function addCard({badgeText, badgeClass, model, move, change, infoText, discountFlag}){
    const list = document.getElementById("list");
    const moveNum = asNum(move), chgNum = asNum(change);

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="titleRow">
        <div class="model">${escapeHtml(model)}</div>
        <div class="badge ${badgeClass}">${escapeHtml(badgeText)}</div>
      </div>
      <div class="infoLine">${escapeHtml(infoText)}</div>
      ${discountFlag ? `<div class="infoLine" style="color:#2563eb;">ìš”ê¸ˆí• ì¸ë„ ê°€ëŠ¥</div>` : ``}
      <div class="priceRow">
        <div class="pill"><div class="k">ì´ë™</div><div class="v ${vClass(moveNum)}">${escapeHtml((String(move??"").trim()==="")?"-":String(move))}</div></div>
        <div class="pill"><div class="k">ê¸°ë³€</div><div class="v ${vClass(chgNum)}">${escapeHtml((String(change??"").trim()==="")?"-":String(change))}</div></div>
      </div>
    `;
    list.appendChild(card);
  }

  async function renderTab(tab){
    clearList();
    setEmpty(false,"");

    try{
      const { items, header } = await fetchCSV("data.csv");
      if (!items.length){
        setEmpty(true, "data.csvê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.");
        return;
      }

      const modelKey = findKey(header, ["ê¸°ì¢…","ëª¨ë¸","ëª¨ë¸ëª…","model","device"]);
      if (!modelKey){
        setEmpty(true, `CSV í—¤ë”ì— 'ê¸°ì¢…(ëª¨ë¸ëª…)' ì»¬ëŸ¼ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\ní˜„ì¬ í—¤ë”:\n- ${header.join("\n- ")}`);
        return;
      }

      const sk = mkCarrierKeys(header,"SK");
      const kt = mkCarrierKeys(header,"KT");
      const lg = mkCarrierKeys(header,"LG");

      const valid = items.filter(x => String(x[modelKey] ?? "").trim() !== "");
      if (!valid.length){
        setEmpty(true, "ëª¨ë¸(ê¸°ì¢…) ê°’ì´ ìˆëŠ” í–‰ì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      const discountKey = findKey(header, ["ìš”ê¸ˆí• ì¸","discount"]);

      if (tab==="SK" || tab==="KT" || tab==="LG"){
        const k = (tab==="SK")?sk:(tab==="KT")?kt:lg;
        const badgeClass = (tab==="SK")?"sk":(tab==="KT")?"kt":"lg";

        valid.forEach(x=>{
          addCard({
            badgeText: tab,
            badgeClass,
            model: x[modelKey],
            move: k.move ? x[k.move] : "",
            change: k.chg ? x[k.chg] : "",
            infoText: infoLine(tab, x, k.plan),
            discountFlag: discountKey ? (String(x[discountKey]).trim().toUpperCase()==="O") : false
          });
        });
        return;
      }

      if (tab==="HOT"){
        const hot = valid.filter(x=>{
          const nums = [
            sk.move?asNum(x[sk.move]):null, sk.chg?asNum(x[sk.chg]):null,
            kt.move?asNum(x[kt.move]):null, kt.chg?asNum(x[kt.chg]):null,
            lg.move?asNum(x[lg.move]):null, lg.chg?asNum(x[lg.chg]):null
          ].filter(n=>n!==null);
          return nums.some(n=>n<0);
        });
        if (!hot.length){ setEmpty(true, "í•«ë”œ(ë§ˆì´ë„ˆìŠ¤) í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤."); return; }

        hot.forEach(x=>{
          // ìµœì €ê°’ í†µì‹ ì‚¬ ì„ íƒ
          const cand = [
            {c:"SK", move: sk.move?asNum(x[sk.move]):null, chg: sk.chg?asNum(x[sk.chg]):null, k:sk},
            {c:"KT", move: kt.move?asNum(x[kt.move]):null, chg: kt.chg?asNum(x[kt.chg]):null, k:kt},
            {c:"LG", move: lg.move?asNum(x[lg.move]):null, chg: lg.chg?asNum(x[lg.chg]):null, k:lg},
          ];
          let best=null;
          for (const o of cand){
            const vals=[o.move,o.chg].filter(v=>v!==null);
            if (!vals.length) continue;
            const s=Math.min(...vals);
            if (!best || s<best.s) best={...o,s};
          }
          if (!best) return;
          addCard({
            badgeText: `í•«ë”œ ${best.c}`,
            badgeClass:"hot",
            model:x[modelKey],
            move: best.k.move ? x[best.k.move] : "",
            change: best.k.chg ? x[best.k.chg] : "",
            infoText: infoLine(best.c, x, best.k.plan),
            discountFlag: discountKey ? (String(x[discountKey]).trim().toUpperCase()==="O") : false
          });
        });
        return;
      }

      if (tab==="LOW"){
        const isLow = (k, limit, x) => {
          if (!k.plan) return false;
          const p = asNum(x[k.plan]);
          return p!==null && p>0 && p<limit;
        };
        const low = valid.filter(x => isLow(sk,109,x) || isLow(kt,110,x) || isLow(lg,115,x));
        if (!low.length){ setEmpty(true, "ì €ê°€ìš”ê¸ˆì œ(109/110/115 ë¯¸ë§Œ) í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤."); return; }

        low.forEach(x=>{
          const opts = [];
          if (sk.plan){ const p=asNum(x[sk.plan]); if (p!==null && p>0 && p<109) opts.push({c:"SK",p,k:sk}); }
          if (kt.plan){ const p=asNum(x[kt.plan]); if (p!==null && p>0 && p<110) opts.push({c:"KT",p,k:kt}); }
          if (lg.plan){ const p=asNum(x[lg.plan]); if (p!==null && p>0 && p<115) opts.push({c:"LG",p,k:lg}); }
          opts.sort((a,b)=>a.p-b.p);
          const best = opts[0];
          if (!best) return;

          addCard({
            badgeText:`ì €ê°€ ${best.c} (${best.p})`,
            badgeClass:"low",
            model:x[modelKey],
            move: best.k.move ? x[best.k.move] : "",
            change: best.k.chg ? x[best.k.chg] : "",
            infoText:`${best.c} ${best.p}ìš”ê¸ˆ 6ê°œì›” / ë¶€ê°€í•„ìˆ˜ ë¬¸ì˜`,
            discountFlag: discountKey ? (String(x[discountKey]).trim().toUpperCase()==="O") : false
          });
        });
        return;
      }

    } catch(e){
      setEmpty(true, `CSVë¥¼ ì½ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n- ì‹¤í–‰ì£¼ì†Œê°€ file:/// ì´ë©´ ì•ˆ ë©ë‹ˆë‹¤.\n- data.csv ê²½ë¡œ/íŒŒì¼ëª… í™•ì¸\nì˜¤ë¥˜: ${String(e.message || e)}`);
      console.log(e);
    }
  }

  document.querySelectorAll(".tabBtn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      document.querySelectorAll(".tabBtn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      renderTab(btn.dataset.tab);
    });
  });

  renderTab("SK");
</script>
</body>
</html>
