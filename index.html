<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ë³µì§€ê´€2ì¸µë§¤ì¥</title>

<style>
  :root{
    --bg:#f5f6f8;
    --card:#ffffff;
    --ink:#0f172a;
    --muted:#64748b;
    --line:#e5e7eb;

    --sk:#2563eb;
    --kt:#111827;
    --lg:#16a34a;
    --hot:#f97316;
    --low:#7c3aed;

    --call:#22c55e;
    --sms:#38bdf8;
    --kakao:#fee500;
  }

  *{box-sizing:border-box;}
  html,body{margin:0;padding:0;}
  body{
    font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",system-ui,sans-serif;
    background:var(--bg);
    color:var(--ink);
  }

  .wrap{max-width:760px;margin:0 auto;padding:14px 14px 164px;}

  .hero{
    background:#ffe866;
    border:2px solid #ffeb3b;
    border-radius:14px;
    padding:14px;
    text-align:center;
    font-weight:900;
    box-shadow:0 6px 16px rgba(0,0,0,.08);
  }
  .hero .sub{margin-top:6px;font-weight:800;font-size:14px;}
  .hero .sub b{text-decoration:underline;}

  .tabs.nice{display:flex;gap:8px;margin-top:14px;}
  .tabs.nice .tabBtn{
    flex:1;
    padding:12px 0;
    border-radius:999px;
    border:1px solid var(--line);
    background:#fff;
    font-weight:1000;
    font-size:14px;
    cursor:pointer;
    transition:all .15s ease;
  }
  .tabs.nice .tabBtn:hover{
    transform:translateY(-1px);
    box-shadow:0 4px 10px rgba(0,0,0,.08);
  }
  .tabs.nice .tabBtn.active{color:#fff;border-color:transparent;}
  .tabs.nice .tabBtn.sk.active{background:var(--sk);}
  .tabs.nice .tabBtn.kt.active{background:var(--kt);}
  .tabs.nice .tabBtn.lg.active{background:var(--lg);}
  .tabs.nice .tabBtn.hot.active{background:var(--hot);}
  .tabs.nice .tabBtn.low.active{background:var(--low);}

  .panel{
    margin-top:14px;
    background:#fff;
    border:1px solid var(--line);
    border-radius:16px;
    padding:14px;
  }

  .emptyTitle{font-weight:1000;font-size:16px;margin-bottom:6px;}
  .emptyDesc{color:var(--muted);font-weight:800;font-size:13px;}

  .list{display:flex;flex-direction:column;gap:10px;}
  .card{
    border:1px solid var(--line);
    border-radius:14px;
    padding:12px;
    box-shadow:0 2px 10px rgba(0,0,0,.05);
  }
  .titleRow{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px;}
  .model{font-weight:1000;font-size:16px;letter-spacing:-.2px;}

  .badge{
    font-weight:1000;
    font-size:12px;
    padding:6px 10px;
    border-radius:999px;
    color:#fff;
    white-space:nowrap;
  }
  .badge.sk{background:var(--sk);}
  .badge.kt{background:var(--kt);}
  .badge.lg{background:var(--lg);}
  .badge.hot{background:var(--hot);}
  .badge.low{background:var(--low);}

  .infoLine{
    margin:0 0 10px;
    color:var(--muted);
    font-weight:1000;
    font-size:12px;
  }

  .priceRow{display:flex;gap:10px;}
  .pill{
    flex:1;
    border:1px solid var(--line);
    border-radius:12px;
    padding:10px 10px;
    text-align:center;
    background:#fafafa;
  }
  .pill .k{color:var(--muted);font-weight:1000;font-size:12px;margin-bottom:4px;}
  .pill .v{font-weight:1000;font-size:20px;letter-spacing:-.4px;}
  .neg{color:#dc2626;}
  .zero{color:#0ea5e9;}
  .pos{color:#0f172a;}

  .fixedNotice{
    position:fixed; bottom:60px; left:0; right:0;
    background:#fff;
    border-top:1px solid var(--line);
    text-align:center;
    font-weight:1000;
    padding:10px 12px;
    z-index:998;
    line-height:1.25;
  }

  .bottomBar{
    position:fixed; left:0; right:0; bottom:0;
    background:#fff;
    border-top:1px solid var(--line);
    display:flex; height:60px;
    z-index:999;
  }
  .action{
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:1000;
    text-decoration:none;
    color:#0b1220;
    font-size:16px;
  }
  .action.call{background:var(--call);color:#fff;}
  .action.sms{background:var(--sms);color:#05202b;}
  .action.kakao{background:var(--kakao);color:#3b2f00;}
</style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      ì¸í„°ë„·TVÂ·ì•Œëœ°ìš”ê¸ˆì€ ì¹´í†¡ë¬¸ì˜
      <div class="sub">ğŸª™ ì¸í„°ë„·TV : <b>í˜„ê¸ˆ ìµœëŒ€ ì§€ì›</b></div>
      <div class="sub">ğŸ”¥ ì•Œëœ°ìš”ê¸ˆ : <b>ìµœì €ìš”ê¸ˆ 3,300ì›~</b></div>
    </div>

    <div class="tabs nice">
      <button class="tabBtn sk active" data-tab="SK">SK</button>
      <button class="tabBtn kt" data-tab="KT">KT</button>
      <button class="tabBtn lg" data-tab="LG">LG</button>
      <button class="tabBtn hot" data-tab="HOT">í•«ë”œ</button>
      <button class="tabBtn low" data-tab="LOW">ì €ê°€</button>
    </div>

    <div class="panel">
      <div id="empty" style="display:none;">
        <div class="emptyTitle">í‘œì‹œí•  í•­ëª© ì—†ìŒ</div>
        <div class="emptyDesc" id="emptyDesc">data.csvì— í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>
      </div>
      <div class="list" id="list"></div>
    </div>
  </div>

  <div class="fixedNotice">
    ì•¡ì •í•„ë¦„ ë¬´ë£Œêµì²´<br>
    ì¹´í†¡ ì£¼ë¬¸ í›„ ë³µì§€ê´€2ì¸µ ë§¤ì¥ ë°©ë¬¸
  </div>

  <div class="bottomBar">
    <a class="action call" href="tel:042-821-2272">ì „í™”</a>
    <a class="action sms" href="sms:010-5839-1512">ë¬¸ì</a>
    <a class="action kakao" href="https://open.kakao.com/o/s729bI5h" target="_blank" rel="noopener">ì¹´í†¡</a>
  </div>

<script>
function parseCSV(text){
  text = text.replace(/^\uFEFF/, "");
  const rows = [];
  let row = [], cur = "", inQuotes = false;

  for (let i=0; i<text.length; i++){
    const ch = text[i];
    const next = text[i+1];

    if (inQuotes){
      if (ch === '"' && next === '"'){ cur += '"'; i++; }
      else if (ch === '"'){ inQuotes = false; }
      else { cur += ch; }
    } else {
      if (ch === '"'){ inQuotes = true; }
      else if (ch === ','){ row.push(cur); cur = ""; }
      else if (ch === '\n'){
        row.push(cur);
        if (row.some(v => String(v).trim() !== "")) rows.push(row);
        row = []; cur = "";
      } else if (ch === '\r'){
        // ignore
      } else {
        cur += ch;
      }
    }
  }
  row.push(cur);
  if (row.some(v => String(v).trim() !== "")) rows.push(row);
  return rows;
}

async function fetchCSV(path){
  const url = `${path}?v=${Date.now()}`;
  const res = await fetch(url, { cache: "no-store" });
  if (!res.ok) throw new Error(`${path} ë¡œë“œ ì‹¤íŒ¨`);
  const text = await res.text();
  const rows = parseCSV(text);
  if (!rows.length) return [];
  const header = rows.shift().map(h => String(h).trim());
  return rows.map(r => {
    const o = {};
    header.forEach((h, i) => o[h] = (r[i] ?? "").trim());
    return o;
  });
}

/* âœ… í•µì‹¬: íŠ¹ìˆ˜ ë§ˆì´ë„ˆìŠ¤/ëŒ€ì‹œê¹Œì§€ ì „ë¶€ ìˆ«ìë¡œ ì¸ì‹ */
function asNum(x){
  const s = String(x ?? "")
    .replace(/[âˆ’-â€“â€”â€’ï¹£ï¼]/g, "-")  // ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ëŒ€ì‹œ/ë§ˆì´ë„ˆìŠ¤ë¥¼ '-'ë¡œ í†µì¼
    .replace(/,/g,"")
    .trim();
  if (s === "") return null;
  const n = Number(s);
  return Number.isFinite(n) ? n : null;
}

function vClass(n){
  if (n === null) return "";
  if (n < 0) return "neg";
  if (n === 0) return "zero";
  return "pos";
}
function setEmpty(show, msg){
  const empty = document.getElementById("empty");
  const desc = document.getElementById("emptyDesc");
  empty.style.display = show ? "block" : "none";
  desc.textContent = msg || "";
}
function clearList(){ document.getElementById("list").innerHTML = ""; }

/* âœ… ìš”ê¸ˆì œëŠ” CSV ì‹¤ì œê°’ ìš°ì„  ì‚¬ìš© (ì €ê°€ 33ì´ë©´ 33 í‘œì‹œ) */
function infoLineFromRow(carrier, row){
  const plan = asNum(row?.[`${carrier}_ìš”ê¸ˆì œ`]);
  const defaultPlan = (carrier==="SK") ? 109 : (carrier==="KT") ? 110 : 115;
  const usePlan = (plan !== null && plan > 0) ? plan : defaultPlan;
  return `${carrier} ${usePlan}ìš”ê¸ˆ 6ê°œì›” / ë¶€ê°€í•„ìˆ˜ ë¬¸ì˜`;
}

function addCard({badgeText, badgeClass, model, move, change, infoText, item}){
  const list = document.getElementById("list");
  const moveNum = asNum(move);
  const chgNum  = asNum(change);
  const discountFlag = String(item?.["ìš”ê¸ˆí• ì¸"] || "").trim().toUpperCase() === "O";

  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `
    <div class="titleRow">
      <div class="model">${model}</div>
      <div class="badge ${badgeClass}">${badgeText}</div>
    </div>
    <div class="infoLine">${infoText}</div>
    ${discountFlag ? `<div class="infoLine" style="color:#2563eb;font-weight:1000;">ìš”ê¸ˆí• ì¸ë„ ê°€ëŠ¥</div>` : ``}
    <div class="priceRow">
      <div class="pill">
        <div class="k">ì´ë™</div>
        <div class="v ${vClass(moveNum)}">${(move ?? "").trim()==="" ? "-" : move}</div>
      </div>
      <div class="pill">
        <div class="k">ê¸°ë³€</div>
        <div class="v ${vClass(chgNum)}">${(change ?? "").trim()==="" ? "-" : change}</div>
      </div>
    </div>
  `;
  list.appendChild(card);
}

/* í•«ë”œ ëŒ€í‘œ ì„ íƒ: 3ì‚¬ ì´ë™/ê¸°ë³€ ì¤‘ "ìµœì €ê°’" í†µì‹ ì‚¬ ì„ íƒ */
function pickHotBest(x){
  const candidates = [
    { c:"SK", move:asNum(x["SK_ì´ë™"]), change:asNum(x["SK_ê¸°ë³€"]) },
    { c:"KT", move:asNum(x["KT_ì´ë™"]), change:asNum(x["KT_ê¸°ë³€"]) },
    { c:"LG", move:asNum(x["LG_ì´ë™"]), change:asNum(x["LG_ê¸°ë³€"]) }
  ];

  let best = null;
  candidates.forEach(o=>{
    const vals = [o.move, o.change].filter(v=>v!==null);
    if (!vals.length) return;
    const score = Math.min(...vals);
    if (best === null || score < best.score){
      best = {
        c: o.c,
        score,
        moveStr: x[`${o.c}_ì´ë™`] ?? "",
        changeStr: x[`${o.c}_ê¸°ë³€`] ?? ""
      };
    }
  });
  return best;
}

function pickLowBest(x){
  const opts = [
    { c:"SK", plan:asNum(x["SK_ìš”ê¸ˆì œ"]), limit:109 },
    { c:"KT", plan:asNum(x["KT_ìš”ê¸ˆì œ"]), limit:110 },
    { c:"LG", plan:asNum(x["LG_ìš”ê¸ˆì œ"]), limit:115 }
  ].filter(o => o.plan !== null && o.plan > 0 && o.plan < o.limit);

  if (!opts.length) return null;
  opts.sort((a,b)=>a.plan-b.plan);
  const best = opts[0];
  return {
    c: best.c,
    plan: best.plan,
    moveStr: x[`${best.c}_ì´ë™`] ?? "",
    changeStr: x[`${best.c}_ê¸°ë³€`] ?? ""
  };
}

async function renderTab(tab){
  clearList();
  setEmpty(false,"");

  try{
    const items = await fetchCSV("data.csv");
    const valid = items.filter(x => x["ê¸°ì¢…"] && String(x["ê¸°ì¢…"]).trim() !== "");

    if (!valid.length){
      setEmpty(true, "data.csvì— íœ´ëŒ€í° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");
      return;
    }

    if (tab === "SK" || tab === "KT" || tab === "LG"){
      const badgeClass = tab === "SK" ? "sk" : (tab === "KT" ? "kt" : "lg");
      valid.forEach(x=>{
        addCard({
          badgeText: tab,
          badgeClass,
          model: x["ê¸°ì¢…"],
          move: x[`${tab}_ì´ë™`] ?? "",
          change: x[`${tab}_ê¸°ë³€`] ?? "",
          infoText: infoLineFromRow(tab, x),   // âœ… ì‹¤ì œ ìš”ê¸ˆì œ í‘œì‹œ
          item: x
        });
      });
      return;
    }

    if (tab === "HOT"){
      // âœ… ì´ë™/ê¸°ë³€ ì¤‘ ë§ˆì´ë„ˆìŠ¤ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ í•«ë”œ
      const hot = valid.filter(x=>{
        const nums = [
          asNum(x["SK_ì´ë™"]), asNum(x["SK_ê¸°ë³€"]),
          asNum(x["KT_ì´ë™"]), asNum(x["KT_ê¸°ë³€"]),
          asNum(x["LG_ì´ë™"]), asNum(x["LG_ê¸°ë³€"])
        ].filter(n=>n!==null);
        return nums.some(n => n < 0);
      });

      if (!hot.length){
        setEmpty(true, "í•«ë”œ(ì´ë™/ê¸°ë³€ ë§ˆì´ë„ˆìŠ¤) í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      hot.forEach(x=>{
        const best = pickHotBest(x);
        if (!best) return;
        addCard({
          badgeText: `í•«ë”œ ${best.c}`,
          badgeClass: "hot",
          model: x["ê¸°ì¢…"],
          move: best.moveStr,
          change: best.changeStr,
          infoText: infoLineFromRow(best.c, x), // âœ… ì €ê°€í°ì´ë©´ 33ìš”ê¸ˆ ê·¸ëŒ€ë¡œ í‘œì‹œ
          item: x
        });
      });
      return;
    }

    if (tab === "LOW"){
      const low = valid.filter(x=>{
        const sk = asNum(x["SK_ìš”ê¸ˆì œ"]);
        const kt = asNum(x["KT_ìš”ê¸ˆì œ"]);
        const lg = asNum(x["LG_ìš”ê¸ˆì œ"]);
        return (sk!==null && sk>0 && sk<109) || (kt!==null && kt>0 && kt<110) || (lg!==null && lg>0 && lg<115);
      });

      if (!low.length){
        setEmpty(true, "ì €ê°€ìš”ê¸ˆì œ(109/110/115 ë¯¸ë§Œ) í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      low.forEach(x=>{
        const best = pickLowBest(x);
        if (!best) return;
        addCard({
          badgeText: `ì €ê°€ ${best.c} (${best.plan})`,
          badgeClass: "low",
          model: x["ê¸°ì¢…"],
          move: best.moveStr,
          change: best.changeStr,
          infoText: `${best.c} ${best.plan}ìš”ê¸ˆ 6ê°œì›” / ë¶€ê°€í•„ìˆ˜ ë¬¸ì˜`,
          item: x
        });
      });
      return;
    }

  }catch(e){
    console.log(e);
    setEmpty(true, "CSV íŒŒì¼ì„ ì½ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (data.csv íŒŒì¼ëª…/ìœ„ì¹˜ í™•ì¸)");
  }
}

document.querySelectorAll(".tabBtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.querySelectorAll(".tabBtn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    renderTab(btn.dataset.tab);
  });
});

renderTab("SK");
</script>
</body>
</html>
